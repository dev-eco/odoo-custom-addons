<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Grupo de seguridad para gestionar direcciones alternativas -->
    <record id="group_alternative_delivery_addresses" model="res.groups">
        <field name="name">Gestionar direcciones de entrega alternativas</field>
        <field name="category_id" ref="base.module_category_sales_sales"/>
        <field name="implied_ids" eval="[(4, ref('sales_team.group_sale_salesman'))]"/>
    </record>

    <!-- Regla para limitar visibilidad de direcciones públicas para usuarios portal -->
    <record id="rule_partner_delivery_address_visibility" model="ir.rule">
        <field name="name">Direcciones de entrega: visibilidad limitada</field>
        <field name="model_id" ref="base.model_res_partner"/>
        <field name="domain_force">['|', '|', '|', ('id', 'child_of', user.partner_id.id), ('alternative_delivery_for_partner_ids', 'in', user.partner_id.id), ('is_public_delivery_address', '=', True), ('create_uid', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
    </record>

    <!-- Regla para asegurar que usuarios internos pueden ver direcciones públicas -->
    <record id="rule_partner_public_delivery_address_visibility" model="ir.rule">
        <field name="name">Direcciones públicas: visibles para usuarios internos</field>
        <field name="model_id" ref="base.model_res_partner"/>
        <field name="domain_force">['|', ('is_public_delivery_address', '=', True), ('id', 'not in', [])]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>
</odoo>
