<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        <!-- Plantilla de correo para notificar cuando un documento ha sido procesado -->
        <record id="email_template_document_processed" model="mail.template">
            <field name="name">Documento Procesado</field>
            <field name="model_id" ref="model_document_automation"/>
            <field name="subject">Documento ${object.name} procesado correctamente</field>
            <field name="email_from">${user.email_formatted}</field>
            <field name="partner_to">${object.user_id.partner_id.id}</field>
            <field name="body_html" type="html">
                <div style="margin: 0px; padding: 0px; font-size: 13px;">
                    <p style="margin: 0px; padding: 0px; font-size: 13px;">
                        Hola ${object.user_id.name},
                    </p>
                    <p style="margin: 0px; padding: 0px; font-size: 13px;">
                        El documento <strong>${object.name}</strong> ha sido procesado automáticamente.
                    </p>
                    <div style="margin: 16px 0px 16px 0px;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr>
                                <td style="padding: 5px; border: 1px solid #ccc; width: 30%;">Documento</td>
                                <td style="padding: 5px; border: 1px solid #ccc;">${object.name}</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px; border: 1px solid #ccc;">Tipo de documento</td>
                                <td style="padding: 5px; border: 1px solid #ccc;">${object.document_type_id.name or 'No determinado'}</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px; border: 1px solid #ccc;">Fecha de procesamiento</td>
                                <td style="padding: 5px; border: 1px solid #ccc;">${format_datetime(object.processed_date, tz=user.tz or 'UTC')}</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px; border: 1px solid #ccc;">Nivel de confianza</td>
                                <td style="padding: 5px; border: 1px solid #ccc;">${'%.2f' % (object.confidence_score * 100) + '%' if object.confidence_score else 'No disponible'}</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px; border: 1px solid #ccc;">Estado</td>
                                <td style="padding: 5px; border: 1px solid #ccc;">${dict(object._fields['state'].selection).get(object.state)}</td>
                            </tr>
                        </table>
                    </div>
                    <p>Puede ver los detalles completos del documento haciendo <a href="/web#id=${object.id}&amp;model=document.automation&amp;view_type=form">clic aquí</a>.</p>
                    <p>Saludos,<br/>${user.name}</p>
                </div>
            </field>
            <field name="lang">${object.user_id.lang}</field>
            <field name="auto_delete" eval="True"/>
        </record>

        <!-- Plantilla de correo para notificar cuando un documento requiere validación manual -->
        <record id="email_template_document_to_validate" model="mail.template">
            <field name="name">Documento Requiere Validación</field>
            <field name="model_id" ref="model_document_automation"/>
            <field name="subject">Documento ${object.name} requiere validación manual</field>
            <field name="email_from">${user.email_formatted}</field>
            <field name="partner_to">${object.user_id.partner_id.id}</field>
            <field name="body_html" type="html">
                <div style="margin: 0px; padding: 0px; font-size: 13px;">
                    <p style="margin: 0px; padding: 0px; font-size: 13px;">
                        Hola ${object.user_id.name},
                    </p>
                    <p style="margin: 0px; padding: 0px; font-size: 13px;">
                        El documento <strong>${object.name}</strong> ha sido procesado, pero requiere validación manual antes de continuar.
                    </p>
                    <div style="margin: 16px 0px 16px 0px;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr>
                                <td style="padding: 5px; border: 1px solid #ccc; width: 30%;">Documento</td>
                                <td style="padding: 5px; border: 1px solid #ccc;">${object.name}</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px; border: 1px solid #ccc;">Tipo de documento</td>
                                <td style="padding: 5px; border: 1px solid #ccc;">${object.document_type_id.name or 'No determinado'}</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px; border: 1px solid #ccc;">Fecha de procesamiento</td>
                                <td style="padding: 5px; border: 1px solid #ccc;">${format_datetime(object.processed_date, tz=user.tz or 'UTC')}</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px; border: 1px solid #ccc;">Nivel de confianza</td>
                                <td style="padding: 5px; border: 1px solid #ccc;">${'%.2f' % (object.confidence_score * 100) + '%' if object.confidence_score else 'No disponible'}</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px; border: 1px solid #ccc;">Estado</td>
                                <td style="padding: 5px; border: 1px solid #ccc;">${dict(object._fields['state'].selection).get(object.state)}</td>
                            </tr>
                        </table>
                    </div>
                    <p>Para validar este documento, por favor <a href="/web#id=${object.id}&amp;model=document.automation&amp;view_type=form">acceda al sistema</a> y revise la información extraída.</p>
                    <p>Saludos,<br/>${user.name}</p>
                </div>
            </field>
            <field name="lang">${object.user_id.lang}</field>
            <field name="auto_delete" eval="True"/>
        </record>

        <!-- Plantilla de correo para notificar cuando hay un error en el procesamiento -->
        <record id="email_template_document_error" model="mail.template">
            <field name="name">Error en Procesamiento de Documento</field>
            <field name="model_id" ref="model_document_automation"/>
            <field name="subject">Error al procesar el documento ${object.name}</field>
            <field name="email_from">${user.email_formatted}</field>
            <field name="partner_to">${object.user_id.partner_id.id}</field>
            <field name="body_html" type="html">
                <div style="margin: 0px; padding: 0px; font-size: 13px;">
                    <p style="margin: 0px; padding: 0px; font-size: 13px;">
                        Hola ${object.user_id.name},
                    </p>
                    <p style="margin: 0px; padding: 0px; font-size: 13px;">
                        Ha ocurrido un error al procesar el documento <strong>${object.name}</strong>.
                    </p>
                    <div style="margin: 16px 0px 16px 0px; padding: 10px; border-left: 3px solid #FF0000;">
                        <p style="margin: 0px; padding: 0px; font-size: 13px;">
                            <strong>Mensaje de error:</strong><br/>
                            ${object.status_message or 'Error no especificado'}
                        </p>
                    </div>
                    <div style="margin: 16px 0px 16px 0px;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr>
                                <td style="padding: 5px; border: 1px solid #ccc; width: 30%;">Documento</td>
                                <td style="padding: 5px; border: 1px solid #ccc;">${object.name}</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px; border: 1px solid #ccc;">Tipo de documento</td>
                                <td style="padding: 5px; border: 1px solid #ccc;">${object.document_type_id.name or 'No determinado'}</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px; border: 1px solid #ccc;">Fecha</td>
                                <td style="padding: 5px; border: 1px solid #ccc;">${format_datetime(object.create_date, tz=user.tz or 'UTC')}</td>
                            </tr>
                        </table>
                    </div>
                    <p>Para revisar y reintentar el procesamiento, por favor <a href="/web#id=${object.id}&amp;model=document.automation&amp;view_type=form">acceda al documento</a> en el sistema.</p>
                    <p>Saludos,<br/>${user.name}</p>
                </div>
            </field>
            <field name="lang">${object.user_id.lang}</field>
            <field name="auto_delete" eval="True"/>
        </record>

    </data>
</odoo>
