<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="res_config_settings_view_form_document_automation" model="ir.ui.view">
        <field name="name">res.config.settings.view.form.inherit.document.automation</field>
        <field name="model">res.config.settings</field>
        <field name="priority">20</field>
        <field name="inherit_id" ref="base.res_config_settings_view_form"/>
        <field name="arch" type="xml">
            <form position="inside">
                <!-- Nota: Usamos setting en lugar de div para mejor integración con Odoo 17 -->
                <setting id="document_automation_setting" string="Automatización de Documentos" help="Configuración para la automatización de documentos">
                    <h2>Automatización de Documentos</h2>
                    <div class="row mt16 o_settings_container" id="document_automation_settings">
                        <!-- Configuración de Email -->
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="document_automation_enable_email"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="document_automation_enable_email" string="Recepción por Email"/>
                                <div class="text-muted">
                                    Permite recibir documentos automáticamente vía email
                                </div>
                                <div class="mt8" attrs="{'invisible': [('document_automation_enable_email', '=', False)]}">
                                    <label for="document_automation_email_alias" string="Alias de correo" class="o_light_label"/>
                                    <field name="document_automation_email_alias" placeholder="documentos@empresa.com"/>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Configuración de Escáner Local -->
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="document_automation_enable_scanner"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="document_automation_enable_scanner" string="Escáner Local"/>
                                <div class="text-muted">
                                    Permite recibir documentos desde el cliente de escáner
                                </div>
                                <div class="row mt8" attrs="{'invisible': [('document_automation_enable_scanner', '=', False)]}">
                                    <div class="col-lg-6">
                                        <label for="document_automation_api_key" string="API Key" class="o_light_label"/>
                                        <div class="d-flex">
                                            <field name="document_automation_api_key" 
                                                   password="true" 
                                                   attrs="{'invisible': [('document_automation_show_api_key', '=', True)]}"/>
                                            <field name="document_automation_api_key" 
                                                   attrs="{'invisible': [('document_automation_show_api_key', '=', False)]}"/>
                                            <field name="document_automation_show_api_key" widget="boolean_toggle"/>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <label for="document_automation_api_secret" string="API Secret" class="o_light_label"/>
                                        <field name="document_automation_api_secret" password="true"/>
                                    </div>
                                </div>
                                <div class="mt8" attrs="{'invisible': [('document_automation_enable_scanner', '=', False)]}">
                                    <button string="Generar Credenciales" type="object" name="action_generate_api_credentials" class="btn btn-primary"/>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Configuración de OCR Tesseract -->
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                            </div>
                            <div class="o_setting_right_pane">
                                <!-- Agregada clase o_form_label a todas las etiquetas sin atributo for -->
                                <span class="o_form_label">Configuración OCR Tesseract</span>
                                <div class="text-muted">
                                    Configuración del motor OCR Tesseract
                                </div>
                                <div class="row mt8">
                                    <div class="col-lg-6">
                                        <label for="document_automation_tesseract_path" string="Ruta a Tesseract" class="o_light_label"/>
                                        <field name="document_automation_tesseract_path" placeholder="tesseract"/>
                                    </div>
                                    <div class="col-lg-6">
                                        <label for="document_automation_ocr_language" string="Idioma OCR" class="o_light_label"/>
                                        <field name="document_automation_ocr_language" placeholder="spa"/>
                                    </div>
                                </div>
                                <div class="mt8">
                                    <button string="Probar OCR" type="object" name="action_test_tesseract" class="btn btn-secondary"/>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Configuración de Procesamiento -->
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="document_automation_auto_process"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="document_automation_auto_process" string="Procesamiento Automático"/>
                                <div class="text-muted">
                                    Procesa automáticamente documentos recibidos
                                </div>
                            </div>
                        </div>
                        
                        <!-- Configuración de Validación -->
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="document_automation_auto_validate"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="document_automation_auto_validate" string="Validación Automática"/>
                                <div class="text-muted">
                                    Valida automáticamente documentos con alta confianza de OCR
                                </div>
                                <div class="row mt8" attrs="{'invisible': [('document_automation_auto_validate', '=', False)]}">
                                    <div class="col-lg-6">
                                        <label for="document_automation_validation_threshold" string="Umbral de confianza (%)" class="o_light_label"/>
                                        <field name="document_automation_validation_threshold"/>
                                    </div>
                                    <div class="col-lg-6">
                                        <label for="document_automation_retry_attempts" string="Intentos máximos" class="o_light_label"/>
                                        <field name="document_automation_retry_attempts"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </setting>
            </form>
        </field>
    </record>
</odoo>
