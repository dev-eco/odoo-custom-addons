<?xml version="1.0" encoding="utf-8"?>
<!--
=============================================================================
VISTAS PARA PLANTILLAS DE EXPORTACI√ìN - VERSI√ìN CORREGIDA
=============================================================================

Este archivo define las interfaces de usuario para gestionar las plantillas
de nomenclatura que se usan durante la exportaci√≥n masiva de facturas.

CAMBIOS REALIZADOS EN ESTA CORRECCI√ìN:
======================================
- example_output ‚Üí preview_example (para coincidir con el modelo Python)
- A√±adidos campos faltantes que est√°n definidos en el modelo
- Corregidas referencias a campos inexistentes
- Mejorada organizaci√≥n visual y usabilidad

PRINCIPIOS DE DISE√ëO APLICADOS:
===============================
1. Consistencia: Todos los nombres de campo coinciden exactamente con el modelo
2. Claridad: Etiquetas descriptivas y ayuda contextual
3. Usabilidad: Flujo natural de configuraci√≥n
4. Feedback: Vista previa inmediata de cambios
-->

<odoo>
    <data>

        <!-- 
        =================================================================
        VISTA DE LISTA (TREE) - GESTI√ìN R√ÅPIDA DE PLANTILLAS
        =================================================================
        
        Esta vista permite ver y editar r√°pidamente m√∫ltiples plantillas
        con funciones como edici√≥n inline y reordenamiento por drag&drop.
        -->
        <record id="view_export_template_tree" model="ir.ui.view">
            <field name="name">export.template.tree</field>
            <field name="model">export.template</field>
            <field name="arch" type="xml">
                <tree string="Plantillas de Nomenclatura" 
                      sample="1" 
                      multi_edit="1"
                      default_order="sequence,name"
                      decoration-info="is_default == True"
                      decoration-muted="active == False">
                    
                    <!-- Handle para reordenar por drag & drop -->
                    <field name="sequence" widget="handle"/>
                    
                    <!-- Campos principales visibles -->
                    <field name="name" string="Nombre"/>
                    <field name="pattern" string="Patr√≥n"/>
                    <field name="preview_example" string="Ejemplo" readonly="1"/>
                    
                    <!-- Toggles para estado -->
                    <field name="is_default" widget="boolean_toggle" string="Por Defecto"/>
                    <field name="active" widget="boolean_toggle" string="Activo"/>
                    
                    <!-- Informaci√≥n adicional -->
                    <field name="company_id" groups="base.group_multi_company" string="Empresa"/>
                    <field name="usage_count" string="Usos" readonly="1"/>
                    
                    <!-- Campos ocultos para filtros y funcionalidad -->
                    <field name="id" invisible="1"/>
                    
                    <!-- Bot√≥n de acci√≥n para probar plantilla -->
                    <button name="action_test_pattern" 
                            type="object" 
                            icon="fa-flask" 
                            title="Probar esta plantilla"
                            string="Probar"/>
                </tree>
            </field>
        </record>

        <!-- 
        =================================================================
        VISTA DE FORMULARIO - CONFIGURACI√ìN DETALLADA DE PLANTILLA
        =================================================================
        
        Vista completa para crear y configurar plantillas con todas
        las opciones disponibles y feedback visual inmediato.
        -->
        <record id="view_export_template_form" model="ir.ui.view">
            <field name="name">export.template.form</field>
            <field name="model">export.template</field>
            <field name="arch" type="xml">
                <form string="Plantilla de Nomenclatura">
                    
                    <!-- HEADER CON BOTONES DE ACCI√ìN -->
                    <header>
                        <button name="action_test_pattern" 
                                type="object" 
                                string="üß™ Probar Plantilla" 
                                class="btn-secondary"
                                help="Probar la plantilla con datos de ejemplo"/>
                        
                        <!-- Statusbar para mostrar si est√° activa -->
                        <field name="active" widget="boolean_button" 
                               options="{'terminology': 'archive'}"/>
                    </header>

                    <sheet>
                        
                        <!-- Widget de estado archivado -->
                        <widget name="web_ribbon" 
                                title="Archivado" 
                                bg_color="bg-danger" 
                                attrs="{'invisible': [('active', '=', True)]}"/>

                        <!-- T√çTULO PRINCIPAL -->
                        <div class="oe_title">
                            <div class="oe_edit_only">
                                <label for="name" string="Nombre de la Plantilla"/>
                            </div>
                            <h1>
                                <field name="name" 
                                       placeholder="ej: Exportaci√≥n Mensual para Asesor√≠a"/>
                            </h1>
                        </div>

                        <!-- CONFIGURACI√ìN B√ÅSICA -->
                        <group name="main_config">
                            <group name="basic_info" string="Informaci√≥n B√°sica">
                                <field name="company_id" 
                                       groups="base.group_multi_company"
                                       options="{'no_create': True}"/>
                                <field name="sequence" string="Orden"/>
                                <field name="is_default" string="Plantilla por Defecto"/>
                                <field name="description" string="Descripci√≥n"/>
                            </group>
                            
                            <group name="usage_stats" string="Estad√≠sticas de Uso">
                                <field name="usage_count" readonly="1" string="Veces Utilizada"/>
                                <label for="preview_example" string="Vista Previa"/>
                                <div>
                                    <field name="preview_example" readonly="1" nolabel="1" 
                                           class="text-info font-monospace"/>
                                    <div class="text-muted" style="font-size: 11px;">
                                        Este ejemplo se actualiza autom√°ticamente al cambiar el patr√≥n
                                    </div>
                                </div>
                            </group>
                        </group>

                        <!-- CONFIGURACI√ìN DEL PATR√ìN -->
                        <group name="pattern_config" string="üìù Configuraci√≥n del Patr√≥n">
                            <group string="Patr√≥n de Nomenclatura">
                                <field name="pattern" 
                                       widget="text"
                                       placeholder="{type}_{number}_{partner}_{date}.pdf"
                                       help="Define c√≥mo se nombrar√°n los archivos usando variables"/>
                            </group>
                            
                            <group string="Variables Disponibles">
                                <div style="padding: 10px; background: #f8f9fa; border-radius: 4px;">
                                    <h4 style="margin-top: 0; color: #495057;">Variables que puedes usar:</h4>
                                    <ul style="margin-bottom: 0; color: #6c757d;">
                                        <li><code>{type}</code> - Tipo de documento (CLIENTE, PROVEEDOR, NC_CLIENTE, NC_PROVEEDOR)</li>
                                        <li><code>{number}</code> - N√∫mero de la factura</li>
                                        <li><code>{partner}</code> - Nombre del cliente/proveedor</li>
                                        <li><code>{date}</code> - Fecha de la factura (YYYY-MM-DD)</li>
                                        <li><code>{year}</code> - A√±o de la factura (YYYY)</li>
                                        <li><code>{month}</code> - Mes de la factura (MM)</li>
                                        <li><code>{company}</code> - Nombre de la empresa</li>
                                        <li><code>{reference}</code> - Referencia del partner</li>
                                    </ul>
                                </div>
                            </group>
                        </group>

                        <!-- EJEMPLOS DE PATRONES COMUNES -->
                        <group name="pattern_examples" string="üí° Ejemplos de Patrones Comunes">
                            <div style="padding: 15px; background: #e3f2fd; border-radius: 4px;">
                                <h4 style="margin-top: 0; color: #1976d2;">Patrones Populares:</h4>
                                <ul style="margin-bottom: 0; color: #424242;">
                                    <li><code>{type}_{number}_{partner}_{date}.pdf</code> - Est√°ndar completo</li>
                                    <li><code>{year}/{month}/{type}_{number}.pdf</code> - Organizado por carpetas de fecha</li>
                                    <li><code>{company}_{type}_{date}_{number}.pdf</code> - Con empresa al inicio</li>
                                    <li><code>{partner}_{number}_{date}.pdf</code> - Simple por cliente</li>
                                    <li><code>Facturas_{year}_{month}_{type}_{number}.pdf</code> - Con prefijo descriptivo</li>
                                </ul>
                            </div>
                        </group>

                        <!-- NOTAS Y DESCRIPCI√ìN ADICIONAL -->
                        <group name="additional_info" string="üìÑ Notas Adicionales">
                            <field name="description" 
                                   widget="text" 
                                   nolabel="1"
                                   placeholder="Describe el prop√≥sito espec√≠fico de esta plantilla, casos de uso, o instrucciones especiales..."/>
                        </group>

                    </sheet>
                </form>
            </field>
        </record>

        <!-- 
        =================================================================
        VISTA DE B√öSQUEDA Y FILTROS
        =================================================================
        
        Permite buscar y filtrar plantillas por diferentes criterios.
        -->
        <record id="view_export_template_search" model="ir.ui.view">
            <field name="name">export.template.search</field>
            <field name="model">export.template</field>
            <field name="arch" type="xml">
                <search string="Buscar Plantillas">
                    
                    <!-- CAMPOS DE B√öSQUEDA R√ÅPIDA -->
                    <field name="name" string="Nombre" filter_domain="[('name', 'ilike', self)]"/>
                    <field name="pattern" string="Patr√≥n" filter_domain="[('pattern', 'ilike', self)]"/>
                    <field name="description" string="Descripci√≥n" filter_domain="[('description', 'ilike', self)]"/>
                    <field name="company_id" groups="base.group_multi_company"/>
                    
                    <!-- FILTROS PREDEFINIDOS -->
                    <separator/>
                    
                    <filter name="filter_active" 
                            string="üü¢ Activas" 
                            domain="[('active', '=', True)]"
                            help="Mostrar solo plantillas activas"/>
                    
                    <filter name="filter_inactive" 
                            string="üî¥ Inactivas" 
                            domain="[('active', '=', False)]"
                            help="Mostrar plantillas archivadas"/>
                    
                    <separator/>
                    
                    <filter name="filter_default" 
                            string="‚≠ê Por Defecto" 
                            domain="[('is_default', '=', True)]"
                            help="Plantillas marcadas como predeterminadas"/>
                    
                    <filter name="filter_frequently_used" 
                            string="üî• M√°s Usadas" 
                            domain="[('usage_count', '>', 0)]"
                            help="Plantillas que se han usado al menos una vez"/>
                    
                    <separator/>
                    
                    <filter name="filter_my_company" 
                            string="üè¢ Mi Empresa" 
                            domain="[('company_id', '=', company_id)]"
                            groups="base.group_multi_company"
                            help="Plantillas de mi empresa actual"/>
                    
                    <!-- AGRUPACIONES -->
                    <group expand="0" string="Agrupar por">
                        <filter name="group_by_company" 
                                string="Empresa" 
                                context="{'group_by': 'company_id'}"
                                groups="base.group_multi_company"/>
                        <filter name="group_by_active" 
                                string="Estado" 
                                context="{'group_by': 'active'}"/>
                        <filter name="group_by_is_default" 
                                string="Por Defecto" 
                                context="{'group_by': 'is_default'}"/>
                    </group>
                    
                    <!-- B√öSQUEDA AVANZADA -->
                    <searchpanel>
                        <field name="company_id" 
                               groups="base.group_multi_company"
                               string="Empresas"
                               icon="fa-building"/>
                        <field name="active" 
                               string="Estado"
                               icon="fa-toggle-on"/>
                    </searchpanel>
                </search>
            </field>
        </record>

        <!-- 
        =================================================================
        ACCI√ìN PRINCIPAL PARA GESTIONAR PLANTILLAS
        =================================================================
        -->
        <record id="action_export_template" model="ir.actions.act_window">
            <field name="name">Plantillas de Exportaci√≥n</field>
            <field name="res_model">export.template</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_export_template_search"/>
            <field name="context">{
                'search_default_filter_active': 1,
                'default_company_id': company_id
            }</field>
            <field name="help" type="html">
                <![CDATA[
                    <p class="o_view_nocontent_smiling_face">
                        ¬°Crea tu primera plantilla de nomenclatura!
                    </p>
                    <p>
                        Las plantillas definen c√≥mo se nombrar√°n los archivos durante
                        la exportaci√≥n masiva de facturas. Esto te permite:
                    </p>
                    <ul>
                        <li>üìÅ Organizar archivos de forma consistente</li>
                        <li>üè∑Ô∏è Incluir informaci√≥n relevante en nombres de archivo</li>
                        <li>‚è∞ Facilitar la b√∫squeda y clasificaci√≥n posterior</li>
                        <li>üìß Tener nombres descriptivos al enviar a terceros</li>
                    </ul>
                    <p>
                        <strong>¬°Empieza creando una plantilla con el bot√≥n "Crear"!</strong>
                    </p>
                ]]>
            </field>
        </record>

        <!-- 
        =================================================================
        √çTEM DE MEN√ö EN CONTABILIDAD
        =================================================================
        -->
        <menuitem id="menu_export_template"
                  name="Plantillas de Exportaci√≥n"
                  parent="account.menu_finance_configuration"
                  action="action_export_template"
                  sequence="80"
                  groups="account.group_account_manager"/>

    </data>
</odoo>
