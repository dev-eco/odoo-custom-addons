<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        EXTENSIÓN DE LA VISTA TREE DE FACTURAS
        
        Este archivo hereda (inherit) de la vista existente de facturas en Odoo
        y le añade elementos adicionales sin modificar el core del sistema.
        
        ¿Por qué usar herencia de vistas?
        - No modifica el módulo base de Odoo (mantiene actualizabilidad)
        - Compatible con otros módulos que también hereden la misma vista
        - Si desinstalamos este módulo, la vista vuelve a su estado original
        - Buena práctica de desarrollo modular y mantenible
        
        XPath: El lenguaje para localizar elementos en XML
        - Es como un selector CSS pero para XML
        - Permite añadir, modificar o eliminar elementos precisos
        - Fundamental para la herencia de vistas en Odoo
    -->
    
    <record id="view_account_move_tree_inherit" model="ir.ui.view">
        <field name="name">account.move.tree.export.button</field>
        <field name="model">account.move</field>
        <!-- 
            inherit_id: ID de la vista base que estamos extendiendo
            
            account.view_invoice_tree es la vista de lista estándar de facturas
            en el módulo account de Odoo. Este ref (referencia) asegura que
            nuestra herencia se aplique correctamente sobre esa vista específica.
        -->
        <field name="inherit_id" ref="account.view_invoice_tree"/>
        <field name="arch" type="xml">
            <!--
                XPath para localizar el header de la vista tree
                
                expr="//tree": Busca el elemento <tree> en cualquier parte del XML
                position="inside": Añade nuestro contenido DENTRO del elemento tree
                
                Otras opciones de position:
                - before: Añade antes del elemento
                - after: Añade después del elemento
                - replace: Reemplaza el elemento completamente
                - attributes: Modifica atributos del elemento sin tocar su contenido
                - inside: Añade dentro del elemento (al final de sus hijos)
            -->
            <xpath expr="//tree" position="inside">
                <!--
                    Header button: Botón que aparece en la cabecera de la vista lista
                    
                    Este botón solo aparece cuando hay facturas seleccionadas
                    y ejecuta directamente el wizard de exportación.
                    
                    ¿Por qué un header button y no un botón normal?
                    - Los header buttons aparecen en la parte superior de la lista
                    - Son visibles sin necesidad de abrir el menú "Acción"
                    - Más descubribles e intuitivos para el usuario
                    - Especialmente útiles para acciones frecuentes
                -->
                <header>
                    <button name="%(action_invoice_export_wizard)s" 
                            type="action"
                            string="📦 Exportar a ZIP"
                            class="btn-primary"
                            help="Exportar las facturas seleccionadas a un archivo ZIP"/>
                    <!--
                        Desglose del botón:
                        
                        name="%(action_invoice_export_wizard)s"
                        - Los %() son sintaxis especial de Odoo para referencias XML
                        - Permite referenciar un registro por su ID XML
                        - En runtime se resuelve al ID de base de datos real
                        - La 's' al final es parte de la sintaxis, no un typo
                        
                        type="action"
                        - Indica que el botón ejecuta una acción (ir.actions.act_window)
                        - Odoo buscará la acción especificada en 'name' y la ejecutará
                        - Diferente de type="object" que llama un método Python
                        
                        string con emoji 📦
                        - Los emojis son totalmente compatibles en Odoo 17
                        - Hacen los botones más visuales y reconocibles
                        - Especialmente útil cuando hay muchos botones similares
                        - Puedes usar cualquier emoji Unicode
                        
                        class="btn-primary"
                        - Botón azul destacado (acción principal)
                        - Otras opciones: btn-secondary, btn-success, btn-danger
                        - Usa btn-primary para la acción más importante
                        
                        help
                        - Texto que aparece al pasar el mouse (tooltip)
                        - Proporciona contexto adicional sin saturar la UI
                        - Importante para accesibilidad y usabilidad
                    -->
                </header>
            </xpath>
            
            <!--
                Alternativa: Botón en la vista de formulario individual
                
                Si descomentas este XPath, también aparecerá un botón cuando
                abras una factura individual. Útil si quieres exportar una
                factura específica sin ir a la vista de lista.
                
                Lo dejo comentado porque para exportación individual, Odoo
                ya tiene el botón "Imprimir" que genera el PDF. Este módulo
                está más enfocado en exportación masiva.
            -->
            <!--
            <xpath expr="//form//header" position="inside">
                <button name="%(action_invoice_export_wizard)s"
                        type="action"
                        string="Exportar esta Factura"
                        attrs="{'invisible': [('state', '!=', 'posted')]}"
                        class="btn-secondary"/>
            </xpath>
            -->
            <!--
                ¿Por qué hacerlo invisible si state != 'posted'?
                
                - Las facturas en borrador pueden no tener PDF generado aún
                - Exportar borradores podría confundir (no son documentos oficiales)
                - Solo facturas confirmadas/publicadas deberían exportarse normalmente
                
                Si necesitas exportar borradores, puedes:
                1. Quitar el atributo attrs completamente
                2. Cambiar a ('state', 'in', ['draft', 'posted'])
                3. Manejar la generación de PDF para borradores en el código Python
            -->
        </field>
    </record>

    <!--
        EXTENSIÓN DE LA VISTA PIVOT/GRAPH (OPCIONAL)
        
        Si tu empresa usa vistas pivot o graph para análisis de facturas,
        podrías querer añadir el botón de exportación también ahí.
        
        Ejemplo de cómo hacerlo:
    -->
    <!--
    <record id="view_account_move_pivot_inherit" model="ir.ui.view">
        <field name="name">account.move.pivot.export.button</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_invoice_pivot"/>
        <field name="arch" type="xml">
            <xpath expr="//pivot" position="attributes">
                <attribute name="string">Facturas con Exportación</attribute>
            </xpath>
        </field>
    </record>
    -->

    <!--
        MEJORA FUTURA: Smart Button en el formulario de cliente
        
        Una mejora potencial sería añadir un smart button en la vista de
        partners (clientes/proveedores) que permita exportar todas sus
        facturas de golpe.
        
        Ejemplo de cómo se vería:
        
        [  📦  ]
        [ ZIP  ]
        
        Este botón mostraría el número de facturas del cliente y al hacer
        clic, abriría el wizard preconfigurado con ese cliente.
        
        Para implementarlo necesitarías:
        1. Computed field en res.partner contando sus facturas
        2. Acción que abra el wizard con domain filtrado por ese partner
        3. Widget="statinfo" en la vista del partner
    -->

</odoo>
