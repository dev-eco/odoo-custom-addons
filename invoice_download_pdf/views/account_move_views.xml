<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        EXTENSI칍N DE LA VISTA TREE DE FACTURAS
        
        Este archivo hereda (inherit) de la vista existente de facturas en Odoo
        y le a침ade elementos adicionales sin modificar el core del sistema.
        
        쯇or qu칠 usar herencia de vistas?
        - No modifica el m칩dulo base de Odoo (mantiene actualizabilidad)
        - Compatible con otros m칩dulos que tambi칠n hereden la misma vista
        - Si desinstalamos este m칩dulo, la vista vuelve a su estado original
        - Buena pr치ctica de desarrollo modular y mantenible
        
        XPath: El lenguaje para localizar elementos en XML
        - Es como un selector CSS pero para XML
        - Permite a침adir, modificar o eliminar elementos precisos
        - Fundamental para la herencia de vistas en Odoo
    -->
    
    <record id="view_account_move_tree_inherit" model="ir.ui.view">
        <field name="name">account.move.tree.export.button</field>
        <field name="model">account.move</field>
        <!-- 
            inherit_id: ID de la vista base que estamos extendiendo
            
            account.view_invoice_tree es la vista de lista est치ndar de facturas
            en el m칩dulo account de Odoo. Este ref (referencia) asegura que
            nuestra herencia se aplique correctamente sobre esa vista espec칤fica.
        -->
        <field name="inherit_id" ref="account.view_invoice_tree"/>
        <field name="arch" type="xml">
            <!--
                XPath para localizar el header de la vista tree
                
                expr="//tree": Busca el elemento <tree> en cualquier parte del XML
                position="inside": A침ade nuestro contenido DENTRO del elemento tree
                
                Otras opciones de position:
                - before: A침ade antes del elemento
                - after: A침ade despu칠s del elemento
                - replace: Reemplaza el elemento completamente
                - attributes: Modifica atributos del elemento sin tocar su contenido
                - inside: A침ade dentro del elemento (al final de sus hijos)
            -->
            <xpath expr="//tree" position="inside">
                <!--
                    Header button: Bot칩n que aparece en la cabecera de la vista lista
                    
                    Este bot칩n solo aparece cuando hay facturas seleccionadas
                    y ejecuta directamente el wizard de exportaci칩n.
                    
                    쯇or qu칠 un header button y no un bot칩n normal?
                    - Los header buttons aparecen en la parte superior de la lista
                    - Son visibles sin necesidad de abrir el men칰 "Acci칩n"
                    - M치s descubribles e intuitivos para el usuario
                    - Especialmente 칰tiles para acciones frecuentes
                -->
                <header>
                    <button name="%(action_invoice_export_wizard)s" 
                            type="action"
                            string="游닍 Exportar a ZIP"
                            class="btn-primary"
                            help="Exportar las facturas seleccionadas a un archivo ZIP"/>
                    <!--
                        Desglose del bot칩n:
                        
                        name="%(action_invoice_export_wizard)s"
                        - Los %() son sintaxis especial de Odoo para referencias XML
                        - Permite referenciar un registro por su ID XML
                        - En runtime se resuelve al ID de base de datos real
                        - La 's' al final es parte de la sintaxis, no un typo
                        
                        type="action"
                        - Indica que el bot칩n ejecuta una acci칩n (ir.actions.act_window)
                        - Odoo buscar치 la acci칩n especificada en 'name' y la ejecutar치
                        - Diferente de type="object" que llama un m칠todo Python
                        
                        string con emoji 游닍
                        - Los emojis son totalmente compatibles en Odoo 17
                        - Hacen los botones m치s visuales y reconocibles
                        - Especialmente 칰til cuando hay muchos botones similares
                        - Puedes usar cualquier emoji Unicode
                        
                        class="btn-primary"
                        - Bot칩n azul destacado (acci칩n principal)
                        - Otras opciones: btn-secondary, btn-success, btn-danger
                        - Usa btn-primary para la acci칩n m치s importante
                        
                        help
                        - Texto que aparece al pasar el mouse (tooltip)
                        - Proporciona contexto adicional sin saturar la UI
                        - Importante para accesibilidad y usabilidad
                    -->
                </header>
            </xpath>
            
            <!--
                Alternativa: Bot칩n en la vista de formulario individual
                
                Si descomentas este XPath, tambi칠n aparecer치 un bot칩n cuando
                abras una factura individual. 칔til si quieres exportar una
                factura espec칤fica sin ir a la vista de lista.
                
                Lo dejo comentado porque para exportaci칩n individual, Odoo
                ya tiene el bot칩n "Imprimir" que genera el PDF. Este m칩dulo
                est치 m치s enfocado en exportaci칩n masiva.
            -->
            <!--
            <xpath expr="//form//header" position="inside">
                <button name="%(action_invoice_export_wizard)s"
                        type="action"
                        string="Exportar esta Factura"
                        attrs="{'invisible': [('state', '!=', 'posted')]}"
                        class="btn-secondary"/>
            </xpath>
            -->
            <!--
                쯇or qu칠 hacerlo invisible si state != 'posted'?
                
                - Las facturas en borrador pueden no tener PDF generado a칰n
                - Exportar borradores podr칤a confundir (no son documentos oficiales)
                - Solo facturas confirmadas/publicadas deber칤an exportarse normalmente
                
                Si necesitas exportar borradores, puedes:
                1. Quitar el atributo attrs completamente
                2. Cambiar a ('state', 'in', ['draft', 'posted'])
                3. Manejar la generaci칩n de PDF para borradores en el c칩digo Python
            -->
        </field>
    </record>

    <!--
        EXTENSI칍N DE LA VISTA PIVOT/GRAPH (OPCIONAL)
        
        Si tu empresa usa vistas pivot o graph para an치lisis de facturas,
        podr칤as querer a침adir el bot칩n de exportaci칩n tambi칠n ah칤.
        
        Ejemplo de c칩mo hacerlo:
    -->
    <!--
    <record id="view_account_move_pivot_inherit" model="ir.ui.view">
        <field name="name">account.move.pivot.export.button</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_invoice_pivot"/>
        <field name="arch" type="xml">
            <xpath expr="//pivot" position="attributes">
                <attribute name="string">Facturas con Exportaci칩n</attribute>
            </xpath>
        </field>
    </record>
    -->

    <!--
        MEJORA FUTURA: Smart Button en el formulario de cliente
        
        Una mejora potencial ser칤a a침adir un smart button en la vista de
        partners (clientes/proveedores) que permita exportar todas sus
        facturas de golpe.
        
        Ejemplo de c칩mo se ver칤a:
        
        [  游닍  ]
        [ ZIP  ]
        
        Este bot칩n mostrar칤a el n칰mero de facturas del cliente y al hacer
        clic, abrir칤a el wizard preconfigurado con ese cliente.
        
        Para implementarlo necesitar칤as:
        1. Computed field en res.partner contando sus facturas
        2. Acci칩n que abra el wizard con domain filtrado por ese partner
        3. Widget="statinfo" en la vista del partner
    -->

</odoo>
