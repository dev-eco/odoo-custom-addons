<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        VISTAS PARA PLANTILLAS DE EXPORTACIÓN
        ====================================
        
        Estas vistas permiten gestionar las plantillas de nomenclatura
        que se usan para generar nombres de archivo durante la exportación.
    -->

    <!-- VISTA DE LISTA -->
    <record id="view_export_template_tree" model="ir.ui.view">
        <field name="name">export.template.tree</field>
        <field name="model">export.template</field>
        <field name="arch" type="xml">
            <tree string="Plantillas de Nomenclatura" 
                  sample="1" 
                  multi_edit="1"
                  default_order="sequence,name">
                
                <!-- Campos principales -->
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="pattern"/>
                <field name="example_output" string="Ejemplo"/>
                <field name="is_default" widget="boolean_toggle"/>
                <field name="active" widget="boolean_toggle"/>
                
                <!-- Campos informativos -->
                <field name="company_id" groups="base.group_multi_company"/>
                <field name="usage_count" string="Usos"/>
                <field name="last_used" string="Último Uso"/>
                
                <!-- Campos ocultos para filtros y agrupaciones -->
                <field name="id" invisible="1"/>
            </tree>
        </field>
    </record>

    <!-- VISTA DE FORMULARIO -->
    <record id="view_export_template_form" model="ir.ui.view">
        <field name="name">export.template.form</field>
        <field name="model">export.template</field>
        <field name="arch" type="xml">
            <form string="Plantilla de Nomenclatura">
                <header>
                    <!-- Botones de acción -->
                    <button name="action_test_template" 
                            type="object" 
                            string="🧪 Probar Plantilla" 
                            class="btn-secondary"
                            help="Probar la plantilla con una factura real"/>
                </header>

                <sheet>
                    <!-- Widget de estado activo/inactivo -->
                    <widget name="web_ribbon" 
                            title="Archivado" 
                            bg_color="bg-danger" 
                            invisible="active"/>

                    <div class="oe_title">
                        <div class="oe_edit_only">
                            <label for="name" string="Nombre de la Plantilla"/>
                        </div>
                        <h1>
                            <field name="name" 
                                   placeholder="ej: Exportación Mensual Asesoría"/>
                        </h1>
                    </div>

                    <!-- Configuración principal -->
                    <group name="main_config">
                        <group name="basic_info" string="Información Básica">
                            <field name="company_id" 
                                   groups="base.group_multi_company"
                                   options="{'no_create': True}"/>
                            <field name="sequence"/>
                            <field name="active"/>
                            <field name="is_default"/>
                        </group>
                        
                        <group name="usage_stats" string="Estadísticas de Uso">
                            <field name="usage_count" readonly="1"/>
                            <field name="last_used" readonly="1"/>
                        </group>
                    </group>

                    <!-- Configuración del patrón -->
                    <group name="pattern_config" string="📝 Configuración del Patrón">
                        <field name="pattern" 
                               widget="text"
                               placeholder="{type}_{number}_{partner}_{date}.pdf"/>
                        
                        <!-- Ejemplo en tiempo real -->
                        <field name="example_output" 
                               readonly="1"
                               string="Vista Previa"
                               class="text-success"/>
                    </group>

                    <!-- Ayuda sobre variables disponibles -->
                    <group name="variables_help" string="💡 Variables Disponibles">
                        <div class="alert alert-info" role="alert">
                            <h5><strong>Variables que puedes usar en el patrón:</strong></h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <ul class="list-unstyled">
                                        <li><code>{type}</code> - Tipo de documento (CLIENTE, PROVEEDOR, NC_CLIENTE, NC_PROVEEDOR)</li>
                                        <li><code>{number}</code> - Número de la factura (ej: INV-2024-001)</li>
                                        <li><code>{partner}</code> - Nombre del cliente/proveedor</li>
                                        <li><code>{date}</code> - Fecha de la factura (YYYY-MM-DD)</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <ul class="list-unstyled">
                                        <li><code>{year}</code> - Año de la factura (YYYY)</li>
                                        <li><code>{month}</code> - Mes de la factura (MM)</li>
                                        <li><code>{company}</code> - Nombre de la empresa</li>
                                        <li><code>{reference}</code> - Referencia del cliente/proveedor</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <h6><strong>Ejemplos de patrones comunes:</strong></h6>
                            <ul class="list-unstyled">
                                <li><code>{type}_{number}_{partner}_{date}.pdf</code> - Patrón estándar completo</li>
                                <li><code>{year}/{month}/{type}_{number}.pdf</code> - Organizado por carpetas de fecha</li>
                                <li><code>{company}_{type}_{date}_{number}.pdf</code> - Con empresa al inicio</li>
                                <li><code>{partner}_{number}_{date}.pdf</code> - Simple por cliente</li>
                            </ul>
                        </div>
                    </group>

                    <!-- Descripción adicional -->
                    <group name="description_group" string="📄 Descripción">
                        <field name="description" 
                               widget="text" 
                               nolabel="1"
                               placeholder="Describe el propósito y uso de esta plantilla..."/>
                    </group>

                </sheet>
            </form>
        </field>
    </record>

    <!-- VISTA DE BÚSQUEDA -->
    <record id="view_export_template_search" model="ir.ui.view">
        <field name="name">export.template.search</field>
        <field name="model">export.template</field>
        <field name="arch" type="xml">
            <search string="Buscar Plantillas">
                
                <!-- Campos de búsqueda -->
                <field name="name" string="Nombre"/>
                <field name="pattern" string="Patrón"/>
                <field name="description" string="Descripción"/>
                <field name="company_id" groups="base.group_multi_company"/>
                
                <!-- Filtros predefinidos -->
                <filter name="filter_active" 
                        string="Activas" 
                        domain="[('active', '=', True)]"/>
                
                <filter name="filter_default" 
                        string="Por Defecto" 
                        domain="[('is_default', '=', True)]"/>
                
                <filter name="filter_my_company" 
                        string="Mi Empresa" 
                        domain="[('company_id', '=', company_id)]"/>
                
                <separator/>
                
                <filter name="filter_unused" 
                        string="Sin Usar" 
                        domain="[('usage_count', '=', 0)]"/>
                
                <filter name="filter_frequently_used" 
                        string="Frecuentemente Usadas" 
                        domain="[('usage_count', '>', 10)]"/>
                
                <!-- Separador -->
                <separator/>
                
                <!-- Filtros de archivo -->
                <filter name="filter_archived" 
                        string="Archivadas" 
                        domain="[('active', '=', False)]"/>

                <!-- Agrupaciones -->
                <group string="Agrupar Por">
                    <filter name="group_company" 
                            string="Empresa" 
                            context="{'group_by': 'company_id'}"
                            groups="base.group_multi_company"/>
                    
                    <filter name="group_default" 
                            string="Tipo" 
                            context="{'group_by': 'is_default'}"/>
                    
                    <filter name="group_usage" 
                            string="Uso" 
                            context="{'group_by': 'usage_count'}"/>
                </group>
            </search>
        </field>
    </record>

    <!--
        ACCIÓN PRINCIPAL PARA PLANTILLAS
        ===============================
    -->
    <record id="action_export_template" model="ir.actions.act_window">
        <field name="name">Plantillas de Nomenclatura</field>
        <field name="res_model">export.template</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="view_export_template_search"/>
        <field name="context">{
            'default_company_id': company_id,
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                ¡Crea tu primera plantilla de nomenclatura!
            </p>
            <p>
                Las plantillas de nomenclatura te permiten definir cómo se nombrarán 
                los archivos PDF durante las exportaciones masivas.
            </p>
            <p>
                <strong>Beneficios:</strong>
            </p>
            <ul>
                <li>Nombres consistentes y organizados</li>
                <li>Fácil identificación de documentos</li>
                <li>Compatibilidad con diferentes sistemas</li>
                <li>Organización automática por fechas, tipos, etc.</li>
            </ul>
        </field>
    </record>

</odoo>
