<?xml version="1.0" encoding="utf-8"?>
<!--
    Vistas para Configuraci√≥n de Exportaci√≥n en Empresas

    Este archivo extiende las vistas existentes del modelo res.company para incluir
    configuraciones espec√≠ficas de nuestro m√≥dulo de exportaci√≥n masiva. Es un
    ejemplo perfecto de c√≥mo Odoo permite extensiones modulares sin modificar
    el c√≥digo base del sistema.

    ¬øPor qu√© extender las vistas de empresa?
    =======================================
    En lugar de crear pantallas separadas para configurar la exportaci√≥n, integramos
    las opciones directamente en la configuraci√≥n de empresa. Esto proporciona:

    1. **Experiencia Unificada**: Los usuarios encuentran las configuraciones donde
       las esperan, en la configuraci√≥n de empresa, no en un lugar separado.

    2. **Contexto Claro**: Las configuraciones est√°n claramente asociadas con la
       empresa espec√≠fica, eliminando ambig√ºedad en entornos multi-empresa.

    3. **Flujo Natural**: Los administradores configuran todo relacionado con la
       empresa en un solo lugar, creando un flujo de trabajo m√°s eficiente.

    4. **Consistencia Visual**: Al usar las mismas vistas y patrones que el core
       de Odoo, nuestra funcionalidad se siente nativa, no como un add-on externo.

    Arquitectura de Herencia de Vistas
    ==================================
    Odoo permite dos tipos de herencia de vistas:

    **Herencia por Extensi√≥n**: A√±adimos elementos a una vista existente sin
    reemplazarla completamente. Esto es lo que hacemos aqu√≠.

    **Herencia por Delegaci√≥n**: Creamos una nueva vista que incluye una vista
    existente como base. M√°s raro y solo para casos especiales.

    La herencia por extensi√≥n es perfecta para nuestro caso porque queremos
    a√±adir configuraciones sin disrumpir el flujo de trabajo existente.
-->

<odoo>
    <!--
        EXTENSI√ìN DE LA VISTA DE FORMULARIO DE EMPRESA
        =============================================
        
        Esta vista hereda del formulario principal de configuraci√≥n de empresa
        y a√±ade una nueva p√°gina espec√≠fica para configuraciones de exportaci√≥n.
        
        El uso de p√°ginas (notebook/page) es ideal cuando a√±adimos configuraciones
        sustanciales que merecen su propio espacio dedicado.
    -->
    <record id="view_company_form_export_settings" model="ir.ui.view">
        <field name="name">res.company.form.export.settings</field>
        <field name="model">res.company</field>
        <field name="inherit_id" ref="base.view_company_form"/>
        <field name="arch" type="xml">
            <!--
                LOCALIZACI√ìN DEL PUNTO DE INSERCI√ìN
                ==================================
                
                Usamos XPath para localizar exactamente d√≥nde queremos a√±adir
                nuestro contenido. En este caso, buscamos el notebook (conjunto
                de pesta√±as) y a√±adimos una nueva p√°gina al final.
                
                ¬øPor qu√© usar position="inside"?
                - A√±ade nuestro contenido DENTRO del elemento encontrado
                - Alternativas: before, after, replace, attributes
                - "inside" es perfecto para a√±adir nuevas p√°ginas a un notebook
            -->
            <xpath expr="//notebook" position="inside">
                <!--
                    NUEVA P√ÅGINA PARA CONFIGURACIONES DE EXPORTACI√ìN
                    ==============================================
                    
                    Esta p√°gina agrupa todas las configuraciones relacionadas
                    con la exportaci√≥n masiva en un espacio dedicado y organizado.
                -->
                <page string="üì¶ Exportaci√≥n Masiva" 
                      name="export_settings_page"
                      groups="account.group_account_manager">
                    <!--
                        groups="account.group_account_manager": Solo visible para
                        gestores contables. Esto tiene sentido porque estas
                        configuraciones afectan el comportamiento del sistema
                        y requieren conocimiento de los procesos contables.
                        
                        name="export_settings_page": ID √∫nico para referenciar
                        esta p√°gina desde otros m√≥dulos si fuera necesario.
                    -->
                    
                    <!--
                        CONFIGURACIONES POR DEFECTO
                        ==========================
                        
                        Primera secci√≥n: configuraciones que se aplicar√°n
                        autom√°ticamente a nuevas exportaciones.
                    -->
                    <group string="üéØ Configuraciones Predeterminadas">
                        <group>
                            <!--
                                Formato de Compresi√≥n con Widget Radio
                                ====================================
                                
                                widget="radio": Muestra todas las opciones
                                visualmente, permitiendo comparaci√≥n f√°cil.
                                Es mejor que un dropdown para 3-4 opciones.
                            -->
                            <field name="default_compression_format" 
                                   widget="radio"
                                   class="o_horizontal"/>
                            
                            <!--
                                Tama√±o de Lote con Validaci√≥n Visual
                                ===================================
                                
                                Este campo incluye validaci√≥n autom√°tica
                                en el modelo Python para asegurar valores
                                razonables que no causen problemas de memoria.
                            -->
                            <field name="default_batch_size"/>
                        </group>
                        
                        <group>
                            <!--
                                Checkboxes para Tipos de Documento
                                =================================
                                
                                Configuraciones booleanas que definen qu√©
                                se preselecciona autom√°ticamente en el wizard.
                            -->
                            <field name="default_include_customer_invoices"/>
                            <field name="default_include_vendor_bills"/>
                            <field name="default_include_credit_notes"/>
                        </group>
                    </group>
                    
                    <!--
                        CONFIGURACIONES DE SEGURIDAD Y L√çMITES
                        ====================================
                        
                        Segunda secci√≥n: configuraciones que controlan
                        l√≠mites y pol√≠ticas de seguridad empresarial.
                    -->
                    <group string="üõ°Ô∏è L√≠mites y Seguridad">
                        <group>
                            <!--
                                L√≠mite M√°ximo de Facturas
                                ========================
                                
                                Previene exportaciones que podr√≠an sobrecargar
                                el servidor o exceder l√≠mites de almacenamiento.
                            -->
                            <field name="max_export_invoices" 
                                   help="L√≠mite m√°ximo de facturas por exportaci√≥n para prevenir sobrecarga del servidor"/>
                            
                            <!--
                                Pol√≠tica de Borradores
                                ====================
                                
                                Controla si los usuarios pueden exportar facturas
                                no confirmadas, lo cual puede ser √∫til para
                                revisiones internas pero riesgoso para entregas externas.
                            -->
                            <field name="allow_draft_export" 
                                   help="Permitir exportar facturas en borrador (√∫til para revisiones internas)"/>
                        </group>
                    </group>
                    
                    <!--
                        CONFIGURACI√ìN DE NOMENCLATURA PERSONALIZADA
                        ==========================================
                        
                        Tercera secci√≥n: permite definir un patr√≥n personalizado
                        a nivel de empresa para casos donde no se usan plantillas.
                    -->
                    <group string="üìù Nomenclatura Personalizada">
                        <!--
                            Activaci√≥n de Patr√≥n Personalizado
                            =================================
                            
                            Checkbox que habilita/deshabilita el uso del
                            patr√≥n personalizado definido abajo.
                        -->
                        <field name="use_custom_filename_pattern" 
                               help="Activar para usar el patr√≥n personalizado cuando no se seleccione una plantilla espec√≠fica"/>
                        
                        <!--
                            Campo de Patr√≥n Condicional
                            ==========================
                            
                            invisible="not use_custom_filename_pattern": Solo
                            muestra este campo cuando la opci√≥n de arriba est√° activada.
                            Esto reduce clutter visual y evita confusi√≥n.
                        -->
                        <field name="custom_filename_pattern" 
                               invisible="not use_custom_filename_pattern"
                               widget="text"
                               help="Patr√≥n usando variables como {doc_type}, {number}, {partner}, {date}"
                               placeholder="{company_code}_{doc_type}_{number}_{date}"/>
                        
                        <!--
                            Bot√≥n de Prueba Condicional
                            ==========================
                            
                            Solo aparece cuando hay un patr√≥n personalizado configurado,
                            permitiendo al usuario verificar que funciona correctamente.
                        -->
                        <button name="test_custom_pattern" 
                                string="üß™ Probar Patr√≥n"
                                type="object"
                                class="btn-secondary"
                                invisible="not use_custom_filename_pattern"
                                help="Probar el patr√≥n personalizado con datos de ejemplo"/>
                    </group>
                    
                    <!--
                        GESTI√ìN DE PLANTILLAS
                        ====================
                        
                        Cuarta secci√≥n: proporciona acceso directo a la gesti√≥n
                        de plantillas espec√≠ficas de esta empresa.
                    -->
                    <group string="üìã Plantillas de Exportaci√≥n">
                        <!--
                            Smart Button para Plantillas
                            ===========================
                            
                            Un smart button que muestra estad√≠sticas y proporciona
                            acceso directo a las plantillas de esta empresa.
                        -->
                        <div class="o_horizontal">
                            <!--
                                Bot√≥n con Contador
                                ================
                                
                                class="oe_stat_button": Estilo especial para
                                botones que muestran estad√≠sticas (smart buttons).
                            -->
                            <button class="oe_stat_button" 
                                    name="action_open_export_templates"
                                    type="object"
                                    icon="fa-file-text-o"
                                    help="Ver y gestionar plantillas de exportaci√≥n para esta empresa">
                                
                                <!--
                                    Campo Estad√≠stico
                                    ================
                                    
                                    widget="statinfo": Formato especial para
                                    mostrar n√∫meros con etiqueta en smart buttons.
                                -->
                                <field name="export_template_count" 
                                       widget="statinfo" 
                                       string="Plantillas"/>
                            </button>
                            
                            <!--
                                Bot√≥n de Creaci√≥n R√°pida
                                =======================
                                
                                Permite crear una nueva plantilla directamente
                                desde la configuraci√≥n de empresa.
                            -->
                            <button class="oe_stat_button" 
                                    name="action_create_export_template"
                                    type="object"
                                    icon="fa-plus"
                                    string="Nueva Plantilla"
                                    help="Crear una nueva plantilla de exportaci√≥n"/>
                        </div>
                        
                        <!--
                            Informaci√≥n sobre Plantilla Predeterminada
                            =========================================
                            
                            Muestra cu√°l es la plantilla predeterminada actual
                            de la empresa, si existe alguna.
                        -->
                        <field name="default_export_template_id" 
                               readonly="1"
                               string="Plantilla Predeterminada Actual"
                               help="Plantilla que se selecciona autom√°ticamente en nuevas exportaciones"/>
                    </group>
                    
                    <!--
                        INFORMACI√ìN Y AYUDA
                        ==================
                        
                        Secci√≥n final: proporciona orientaci√≥n y documentaci√≥n
                        sobre c√≥mo usar las configuraciones de exportaci√≥n.
                    -->
                    <group string="‚ÑπÔ∏è Informaci√≥n y Ayuda" colspan="4">
                        <div class="alert alert-info" role="alert" colspan="4">
                            <strong>üí° C√≥mo funcionan estas configuraciones:</strong>
                            <br/><br/>
                            
                            <strong>1. Configuraciones Predeterminadas:</strong>
                            Valores que se aplicar√°n autom√°ticamente cuando los usuarios
                            abran el wizard de exportaci√≥n masiva.
                            <br/><br/>
                            
                            <strong>2. L√≠mites y Seguridad:</strong>
                            Controles que previenen exportaciones que podr√≠an causar
                            problemas de rendimiento o violar pol√≠ticas empresariales.
                            <br/><br/>
                            
                            <strong>3. Nomenclatura Personalizada:</strong>
                            Patr√≥n de respaldo usado cuando no se selecciona una
                            plantilla espec√≠fica en el wizard.
                            <br/><br/>
                            
                            <strong>4. Plantillas:</strong>
                            Patrones reutilizables que permiten diferentes formatos
                            de nomenclatura para diferentes prop√≥sitos o clientes.
                            <br/><br/>
                            
                            <strong>üîÑ Jerarqu√≠a de Nomenclatura:</strong>
                            <ol>
                                <li>Plantilla seleccionada en el wizard (prioridad m√°s alta)</li>
                                <li>Patr√≥n personalizado de empresa (si est√° activado)</li>
                                <li>Formato por defecto del sistema (respaldo final)</li>
                            </ol>
                        </div>
                    </group>
                </page>
            </xpath>
        </field>
    </record>
    
    <!--
        VISTA SIMPLIFICADA PARA CONFIGURACI√ìN R√ÅPIDA
        ===========================================
        
        Una vista alternativa m√°s simple para usuarios que solo necesitan
        configurar opciones b√°sicas sin acceso a configuraciones avanzadas.
    -->
    <record id="view_company_form_export_simple" model="ir.ui.view">
        <field name="name">res.company.form.export.simple</field>
        <field name="model">res.company</field>
        <field name="inherit_id" ref="base.view_company_form"/>
        <field name="priority">20</field>
        <!--
            priority="20": Prioridad m√°s baja que la vista principal (16).
            Esto significa que la vista principal se usar√° por defecto,
            pero esta vista puede ser llamada espec√≠ficamente cuando se necesite.
        -->
        <field name="groups_id" eval="[(4, ref('account.group_account_user'))]"/>
        <!--
            groups_id: Esta vista est√° disponible para usuarios contables
            b√°sicos, no solo gestores. Proporciona acceso a configuraciones
            esenciales sin abrumar con opciones avanzadas.
        -->
        <field name="arch" type="xml">
            <!--
                INSERCI√ìN EN SECCI√ìN EXISTENTE
                =============================
                
                En lugar de crear una p√°gina nueva, a√±adimos las configuraciones
                b√°sicas a una secci√≥n existente de la vista de empresa.
            -->
            <xpath expr="//group[@name='general_settings']" position="after">
                <!--
                    CONFIGURACIONES B√ÅSICAS DE EXPORTACI√ìN
                    ====================================
                    
                    Solo las configuraciones m√°s esenciales, sin opciones
                    avanzadas que podr√≠an confundir a usuarios b√°sicos.
                -->
                <group string="Exportaci√≥n de Facturas" 
                       name="export_basic_settings"
                       groups="account.group_account_user">
                    
                    <field name="default_compression_format" 
                           string="Formato de Compresi√≥n Preferido"/>
                    
                    <field name="max_export_invoices" 
                           string="M√°ximo de Facturas por Exportaci√≥n"/>
                    
                    <!--
                        Acceso Directo a Plantillas
                        ==========================
                        
                        Versi√≥n simplificada del smart button para acceso
                        r√°pido a plantillas sin estad√≠sticas complejas.
                    -->
                    <div class="o_row">
                        <button name="action_open_export_templates" 
                                string="Gestionar Plantillas"
                                type="object"
                                class="btn-link"
                                icon="fa-external-link"/>
                    </div>
                </group>
            </xpath>
        </field>
    </record>
    
    <!--
        ACCI√ìN PARA CONFIGURACI√ìN DE EXPORTACI√ìN
        =======================================
        
        Acci√≥n espec√≠fica que abre directamente la configuraci√≥n de
        exportaci√≥n de la empresa actual, saltando pasos innecesarios.
    -->
    <record id="action_company_export_config" model="ir.actions.act_window">
        <field name="name">Configuraci√≥n de Exportaci√≥n</field>
        <field name="res_model">res.company</field>
        <field name="view_mode">form</field>
        <field name="target">current</field>
        <!--
            CONTEXTO ESPEC√çFICO
            ==================
            
            Este contexto hace que la acci√≥n abra directamente en la
            p√°gina de configuraci√≥n de exportaci√≥n.
        -->
        <field name="context">{
            'default_id': False,
            'active_test': False,
            'form_view_initial_mode': 'edit'
        }</field>
        <!--
            form_view_initial_mode: 'edit': Abre directamente en modo
            de edici√≥n, ahorrando un clic al usuario.
        -->
        
        <!--
            DOMINIO PARA EMPRESA ACTUAL
            ==========================
            
            Limita la vista a la empresa del usuario actual,
            simplificando la experiencia en entornos multi-empresa.
        -->
        <field name="domain">[('id', '=', user.company_id.id)]</field>
        
        <!--
            VISTA ESPEC√çFICA
            ===============
            
            Fuerza el uso de nuestra vista extendida que incluye
            las configuraciones de exportaci√≥n.
        -->
        <field name="view_id" ref="view_company_form_export_settings"/>
    </record>
    
    <!--
        √çTEM DE MEN√ö PARA ACCESO DIRECTO
        ===============================
        
        Proporciona acceso directo a la configuraci√≥n de exportaci√≥n
        desde el men√∫ de configuraci√≥n contable.
    -->
    <menuitem id="menu_company_export_config"
              name="Configuraci√≥n de Exportaci√≥n"
              parent="account.menu_finance_configuration"
              action="action_company_export_config"
              sequence="10"
              groups="account.group_account_manager"/>
    <!--
        sequence="10": Posici√≥n alta en el men√∫ (valores bajos van primero)
        porque la configuraci√≥n de exportaci√≥n es fundamental para usar
        el m√≥dulo efectivamente.
        
        parent="account.menu_finance_configuration": Ubicado en configuraci√≥n
        contable donde los usuarios esperan encontrar este tipo de ajustes.
    -->
    
    <!--
        EXTENSI√ìN DEL FORMULARIO DE CONFIGURACI√ìN GENERAL
        ===============================================
        
        Para usuarios que prefieren tener todas las configuraciones
        en la vista principal de configuraci√≥n de Odoo.
    -->
    <record id="view_general_configuration_export" model="ir.ui.view">
        <field name="name">res.config.settings.export</field>
        <field name="model">res.config.settings</field>
        <field name="inherit_id" ref="account.res_config_settings_view_form"/>
        <field name="arch" type="xml">
            <!--
                NUEVA SECCI√ìN EN CONFIGURACI√ìN GENERAL
                ====================================
                
                A√±adimos una secci√≥n espec√≠fica para exportaci√≥n en
                la vista principal de configuraci√≥n de contabilidad.
            -->
            <xpath expr="//div[hasclass('settings')]" position="inside">
                <div class="col-12 col-lg-6 o_setting_box" 
                     groups="account.group_account_manager">
                    
                    <!--
                        ENCABEZADO DE LA SECCI√ìN
                        ======================
                        
                        T√≠tulo e icono descriptivo para la secci√≥n de exportaci√≥n.
                    -->
                    <div class="o_setting_left_pane">
                        <field name="module_invoice_batch_export" 
                               widget="upgrade_boolean"/>
                    </div>
                    
                    <div class="o_setting_right_pane">
                        <label for="module_invoice_batch_export"/>
                        <div class="text-muted">
                            Exportaci√≥n masiva de facturas con m√∫ltiples formatos de compresi√≥n
                        </div>
                        
                        <!--
                            ACCESO DIRECTO A CONFIGURACI√ìN
                            =============================
                            
                            Bot√≥n que lleva directamente a la configuraci√≥n
                            detallada de exportaci√≥n en la empresa.
                        -->
                        <div class="content-group">
                            <div class="mt16">
                                <button name="%(action_company_export_config)s" 
                                        string="Configurar Exportaci√≥n"
                                        type="action"
                                        class="btn-link"
                                        icon="fa-arrow-right"/>
                            </div>
                        </div>
                    </div>
                </div>
            </xpath>
        </field>
    </record>

</odoo>

<!--
    PATRONES AVANZADOS DE INTEGRACI√ìN EN ODOO
    ========================================
    
    Integraci√≥n No Invasiva
    -----------------------
    Este enfoque de extensi√≥n de vistas demuestra c√≥mo a√±adir funcionalidad
    significativa sin modificar el core de Odoo:
    
    - Las vistas originales permanecen intactas
    - Nuestra funcionalidad se integra naturalmente
    - La desinstalaci√≥n restaura el estado original completamente
    - No hay conflictos con otros m√≥dulos que usen patrones similares
    
    Jerarqu√≠a de Configuraciones
    ---------------------------
    Implementamos una jerarqu√≠a clara de configuraciones:
    
    1. **Configuraciones de Sistema**: Valores globales por defecto
    2. **Configuraciones de Empresa**: Valores espec√≠ficos por empresa
    3. **Configuraciones de Usuario**: Valores espec√≠ficos por operaci√≥n
    
    Esta jerarqu√≠a permite flexibilidad sin complejidad, donde cada nivel
    puede sobrescribir al anterior seg√∫n las necesidades espec√≠ficas.
    
    Smart Buttons y Navegaci√≥n Contextual
    ------------------------------------
    Los smart buttons proporcionan navegaci√≥n contextual inteligente:
    
    - Muestran estad√≠sticas relevantes (n√∫mero de plantillas)
    - Proporcionan acceso directo a funcionalidad relacionada
    - Mantienen el contexto (empresa espec√≠fica) autom√°ticamente
    - Reducen clics y mejoran la eficiencia del workflow
    
    Vistas M√∫ltiples para Diferentes Audiencias
    ------------------------------------------
    Proporcionamos diferentes niveles de acceso:
    
    - **Vista Completa**: Para administradores con todas las opciones
    - **Vista Simplificada**: Para usuarios b√°sicos con opciones esenciales
    - **Configuraci√≥n General**: Integraci√≥n con flujos existentes
    
    Esto permite que el mismo m√≥dulo sirva tanto a usuarios novatos
    como a usuarios expertos sin compromiser la usabilidad de ninguno.
    
    Conditional UI (Interfaz Condicional)
    ------------------------------------
    Usamos visibilidad condicional extensivamente:
    
    - Campos aparecen solo cuando son relevantes
    - Opciones avanzadas se ocultan hasta que se necesiten
    - Botones cambian seg√∫n el estado actual
    - Ayuda contextual aparece donde es m√°s √∫til
    
    Esto reduce la carga cognitiva y hace que la interfaz se sienta
    m√°s inteligente y responsiva a las necesidades del usuario.
    
    Integration Points (Puntos de Integraci√≥n)
    -----------------------------------------
    El m√≥dulo se integra en m√∫ltiples puntos del sistema:
    
    - **Configuraci√≥n de Empresa**: Configuraciones centralizadas
    - **Configuraci√≥n General**: Acceso desde configuraci√≥n principal
    - **Men√∫s Espec√≠ficos**: Acceso directo para tareas frecuentes
    - **Smart Buttons**: Navegaci√≥n contextual desde registros relacionados
    
    Esta integraci√≥n m√∫ltiple hace que la funcionalidad sea descubrible
    y accesible desde cualquier flujo de trabajo natural del usuario.
-->
