<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        EXTENSI√ìN DE LA VISTA TREE DE FACTURAS
        
        Este archivo hereda (inherit) de la vista existente de facturas en Odoo
        y le a√±ade elementos adicionales sin modificar el core del sistema.
        
        ACTUALIZADO PARA ODOO 17.0
        ==========================
        - Eliminado el uso de attrs (deprecado en Odoo 17)
        - Reemplazado por sintaxis directa de atributos
        - Compatible con la nueva arquitectura de vistas de Odoo 17
        
        ¬øPor qu√© usar herencia de vistas?
        - No modifica el m√≥dulo base de Odoo (mantiene actualizabilidad)
        - Compatible con otros m√≥dulos que tambi√©n hereden la misma vista
        - Si desinstalamos este m√≥dulo, la vista vuelve a su estado original
        - Buena pr√°ctica de desarrollo modular y mantenible
        
        XPath: El lenguaje para localizar elementos en XML
        - Es como un selector CSS pero para XML
        - Permite a√±adir, modificar o eliminar elementos precisos
        - Fundamental para la herencia de vistas en Odoo
    -->
    
    <record id="view_account_move_tree_inherit" model="ir.ui.view">
        <field name="name">account.move.tree.export.button</field>
        <field name="model">account.move</field>
        <!-- 
            inherit_id: ID de la vista base que estamos extendiendo
            
            account.view_invoice_tree es la vista de lista est√°ndar de facturas
            en el m√≥dulo account de Odoo. Este ref (referencia) asegura que
            nuestra herencia se aplique correctamente sobre esa vista espec√≠fica.
        -->
        <field name="inherit_id" ref="account.view_invoice_tree"/>
        <field name="arch" type="xml">
            <!--
                XPath para localizar el header de la vista tree
                
                expr="//tree": Busca el elemento <tree> en cualquier parte del XML
                position="inside": A√±ade nuestro contenido DENTRO del elemento tree
                
                Otras opciones de position:
                - before: A√±ade antes del elemento
                - after: A√±ade despu√©s del elemento
                - replace: Reemplaza el elemento completamente
                - attributes: Modifica atributos del elemento sin tocar su contenido
                - inside: A√±ade dentro del elemento (al final de sus hijos)
            -->
            <xpath expr="//tree" position="inside">
                <!--
                    Header button: Bot√≥n que aparece en la cabecera de la vista lista
                    
                    Este bot√≥n solo aparece cuando hay facturas seleccionadas
                    y ejecuta directamente el wizard de exportaci√≥n.
                    
                    ¬øPor qu√© un header button y no un bot√≥n normal?
                    - Los header buttons aparecen en la parte superior de la lista
                    - Son visibles sin necesidad de abrir el men√∫ "Acci√≥n"
                    - M√°s descubribles e intuitivos para el usuario
                    - Especialmente √∫tiles para acciones frecuentes
                    
                    NOTA IMPORTANTE: Los header buttons en tree views NO necesitan
                    atributos de visibilidad condicional porque Odoo autom√°ticamente
                    los muestra/oculta seg√∫n si hay registros seleccionados.
                -->
                <header>
                    <button name="%(action_invoice_export_wizard)s" 
                            type="action"
                            string="üì¶ Exportar a ZIP"
                            class="btn-primary"
                            help="Exportar las facturas seleccionadas a un archivo ZIP"/>
                    <!--
                        Desglose del bot√≥n:
                        
                        name="%(action_invoice_export_wizard)s"
                        ========================================
                        - Los %() son sintaxis especial de Odoo para referencias XML
                        - Permite referenciar un registro por su ID XML
                        - En runtime se resuelve al ID de base de datos real
                        - La 's' al final es parte de la sintaxis, no un typo
                        
                        type="action"
                        =============
                        - Indica que el bot√≥n ejecuta una acci√≥n (ir.actions.act_window)
                        - Odoo buscar√° la acci√≥n especificada en 'name' y la ejecutar√°
                        - Diferente de type="object" que llama un m√©todo Python
                        - Diferente de type="workflow" (deprecado en Odoo 11+)
                        
                        string con emoji üì¶
                        ==================
                        - Los emojis son totalmente compatibles en Odoo 17
                        - Hacen los botones m√°s visuales y reconocibles
                        - Especialmente √∫til cuando hay muchos botones similares
                        - Puedes usar cualquier emoji Unicode est√°ndar
                        - Alternativas: üóúÔ∏è (compresi√≥n), üìÅ (carpeta), üíæ (guardar)
                        
                        class="btn-primary"
                        ===================
                        - Bot√≥n azul destacado (acci√≥n principal)
                        - Otras opciones disponibles:
                          * btn-secondary: Bot√≥n gris (acci√≥n secundaria)
                          * btn-success: Bot√≥n verde (√©xito/confirmaci√≥n)
                          * btn-danger: Bot√≥n rojo (eliminaci√≥n/acci√≥n destructiva)
                          * btn-warning: Bot√≥n amarillo (advertencia)
                          * btn-info: Bot√≥n azul claro (informaci√≥n)
                        - Usa btn-primary para la acci√≥n m√°s importante del contexto
                        
                        help (tooltip)
                        ==============
                        - Texto que aparece al pasar el mouse sobre el bot√≥n
                        - Proporciona contexto adicional sin saturar la interfaz
                        - Importante para accesibilidad y usabilidad
                        - Debe ser conciso pero descriptivo
                        - En espa√±ol, usar lenguaje claro y directo
                    -->
                </header>
            </xpath>
            
            <!--
                ALTERNATIVA: Bot√≥n en la vista de formulario individual
                
                Si descomentas este XPath, tambi√©n aparecer√° un bot√≥n cuando
                abras una factura individual en vista de formulario. 
                
                √ötil si quieres exportar una factura espec√≠fica directamente
                desde su formulario sin ir a la vista de lista.
                
                Lo dejo comentado porque para exportaci√≥n individual, Odoo
                ya tiene el bot√≥n "Imprimir" que genera el PDF. Este m√≥dulo
                est√° m√°s enfocado en exportaci√≥n masiva (m√∫ltiples facturas).
                
                Sin embargo, si deseas a√±adirlo, simplemente descomenta el
                bloque siguiente y ajusta seg√∫n necesites.
            -->
            <!--
            <xpath expr="//form//header" position="inside">
                <!- -
                    Bot√≥n para exportar desde vista de formulario individual
                    
                    ACTUALIZADO PARA ODOO 17:
                    - Sintaxis antigua: attrs="{'invisible': [('state', '!=', 'posted')]}"
                    - Sintaxis nueva: invisible="state != 'posted'"
                    
                    Explicaci√≥n de la l√≥gica condicional:
                    =====================================
                    - state != 'posted' significa "estado diferente de publicado"
                    - invisible="state != 'posted'" oculta el bot√≥n si NO est√° publicado
                    - Es decir, solo muestra el bot√≥n en facturas publicadas
                    
                    ¬øPor qu√© solo en facturas publicadas?
                    ======================================
                    - Las facturas en borrador pueden no tener PDF generado a√∫n
                    - Exportar borradores podr√≠a confundir (no son documentos oficiales)
                    - Las empresas normalmente solo env√≠an facturas confirmadas a asesor√≠as
                    - Los borradores est√°n sujetos a cambios, no son documentos finales
                    
                    Si necesitas permitir exportar borradores tambi√©n:
                    ==================================================
                    Opci√≥n 1: Quitar el atributo invisible completamente
                    Opci√≥n 2: Cambiar a invisible="state not in ['draft', 'posted']"
                    Opci√≥n 3: A√±adir l√≥gica en Python para manejar borradores especialmente
                - ->
                <button name="%(action_invoice_export_wizard)s"
                        type="action"
                        string="Exportar esta Factura"
                        invisible="state != 'posted'"
                        class="btn-secondary"/>
                <!- -
                    Nota sobre class="btn-secondary":
                    ==================================
                    Aqu√≠ uso btn-secondary (gris) en vez de btn-primary (azul) porque:
                    - En el formulario ya hay botones principales (Confirmar, Enviar, etc.)
                    - Esta acci√≥n de exportar es secundaria en este contexto
                    - Mantiene jerarqu√≠a visual: acciones principales destacan m√°s
                    - Evita que todos los botones sean azules (confusi√≥n visual)
                - ->
            </xpath>
            -->
        </field>
    </record>

    <!--
        EXTENSI√ìN DE LA VISTA PIVOT/GRAPH (OPCIONAL)
        
        Si tu empresa usa vistas pivot o graph para an√°lisis de facturas,
        podr√≠as querer a√±adir el bot√≥n de exportaci√≥n tambi√©n ah√≠.
        
        Las vistas pivot y graph son √∫tiles para an√°lisis y reporter√≠a:
        - Pivot: Tabla din√°mica con agrupaciones y totales
        - Graph: Gr√°ficos de barras, l√≠neas, pastel, etc.
        
        Aunque no es com√∫n exportar desde estas vistas (se usan m√°s para
        visualizaci√≥n que para gesti√≥n de documentos), incluyo un ejemplo
        por si tu caso de uso lo requiere.
        
        Para activarlo, simplemente descomenta el bloque siguiente.
    -->
    <!--
    <record id="view_account_move_pivot_inherit" model="ir.ui.view">
        <field name="name">account.move.pivot.export.button</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_invoice_pivot"/>
        <field name="arch" type="xml">
            <!- -
                Modificar atributos de la vista pivot
                
                position="attributes" permite cambiar atributos del elemento
                sin modificar su contenido interno
            - ->
            <xpath expr="//pivot" position="attributes">
                <!- -
                    Cambiar el t√≠tulo de la vista para indicar funcionalidad a√±adida
                    
                    attribute name="string" cambia el atributo "string"
                    Es √∫til para indicar visualmente que esta vista tiene
                    capacidades adicionales (exportaci√≥n en este caso)
                - ->
                <attribute name="string">Facturas con Exportaci√≥n</attribute>
            </xpath>
            
            <!- -
                Opcional: A√±adir bot√≥n de exportaci√≥n en la vista pivot
                
                Nota: Los botones en vistas pivot funcionan diferente que en tree
                Requieren configuraci√≥n adicional y no es tan com√∫n su uso
                
                Si lo necesitas, consulta la documentaci√≥n de Odoo sobre
                botones en vistas anal√≠ticas (pivot/graph)
            - ->
        </field>
    </record>
    -->

    <!--
        MEJORA FUTURA: Smart Button en el formulario de cliente/proveedor
        
        Una mejora potencial ser√≠a a√±adir un smart button en la vista de
        partners (res.partner) que permita exportar todas las facturas de
        ese cliente o proveedor de golpe.
        
        Visualizaci√≥n del Smart Button:
        ================================
        En la parte superior del formulario de cliente aparecer√≠a:
        
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ    üì¶    ‚îÇ
        ‚îÇ   Exportar‚îÇ
        ‚îÇ Facturas ‚îÇ
        ‚îÇ    15    ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        
        El n√∫mero (15) mostrar√≠a cu√°ntas facturas tiene ese partner
        
        ¬øC√≥mo implementarlo?
        ====================
        
        1. A√±adir campo computed en res.partner:
        
        invoice_count = fields.Integer(
            string='N√∫mero de Facturas',
            compute='_compute_invoice_count'
        )
        
        @api.depends('invoice_ids')
        def _compute_invoice_count(self):
            for partner in self:
                partner.invoice_count = len(partner.invoice_ids)
        
        2. A√±adir acci√≥n que abra el wizard preconfigurado:
        
        def action_export_partner_invoices(self):
            return {
                'type': 'ir.actions.act_window',
                'name': 'Exportar Facturas',
                'res_model': 'invoice.export.wizard',
                'view_mode': 'form',
                'target': 'new',
                'context': {
                    'default_invoice_ids': self.invoice_ids.ids
                }
            }
        
        3. A√±adir el bot√≥n en la vista XML:
        
        <xpath expr="//div[@name='button_box']" position="inside">
            <button class="oe_stat_button" 
                    type="object" 
                    name="action_export_partner_invoices"
                    icon="fa-download">
                <field name="invoice_count" widget="statinfo" 
                       string="Facturas"/>
            </button>
        </xpath>
        
        Esta funcionalidad ser√≠a muy √∫til para:
        ========================================
        - Auditor√≠as de cliente espec√≠fico
        - Enviar historial completo a un cliente
        - An√°lisis de relaci√≥n comercial con un proveedor
        - Preparar documentaci√≥n para reclamaciones o disputas
        
        Si deseas implementar esto, puedo ayudarte a desarrollarlo completamente.
    -->

</odoo>
