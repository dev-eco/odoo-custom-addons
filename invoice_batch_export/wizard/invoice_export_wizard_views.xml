<?xml version="1.0" encoding="utf-8"?>
<!--
    Vistas del Wizard de Exportaci√≥n Masiva

    Este archivo define todas las vistas XML que conforman la interfaz de usuario
    del wizard de exportaci√≥n. En Odoo, las vistas XML son los "moldes" que
    transforman los datos de los modelos Python en interfaces web interactivas.

    ¬øC√≥mo Funciona la Arquitectura Vista-Modelo en Odoo?
    ====================================================
    Imagina que los modelos Python son como los "datos en bruto" y las vistas XML
    son como "plantillas de presentaci√≥n". El navegador web nunca ve directamente
    los modelos Python; en su lugar, Odoo usa las vistas XML para generar HTML, CSS
    y JavaScript que el navegador puede renderizar.

    Esta separaci√≥n es muy poderosa porque:
    1. Los datos (Python) est√°n separados de la presentaci√≥n (XML)
    2. M√∫ltiples vistas pueden mostrar los mismos datos de diferentes formas
    3. Las vistas se pueden personalizar sin tocar la l√≥gica de negocio
    4. Odoo puede optimizar la generaci√≥n de UI autom√°ticamente

    Evoluci√≥n de Sintaxis: Odoo 16 vs Odoo 17
    ==========================================
    Una de las mejoras m√°s significativas en Odoo 17 es la simplificaci√≥n
    de la sintaxis de vistas. Donde antes necesit√°bamos escribir:

    Odoo 16 (sintaxis antigua):
    attrs="{'invisible': [('campo', '=', valor)]}"

    Odoo 17 (sintaxis nueva):
    invisible="campo == valor"

    Esta nueva sintaxis es:
    - M√°s f√°cil de leer y escribir
    - Menos propensa a errores de sintaxis
    - M√°s similar a JavaScript moderno
    - Mejor rendimiento en el navegador

    En este archivo usaremos exclusivamente la sintaxis de Odoo 17 para
    demostrar las mejores pr√°cticas actuales.
-->

<odoo>
    <!--
        VISTA PRINCIPAL DEL WIZARD - FORMULARIO INTERACTIVO
        ==================================================
        
        Esta vista implementa el formulario principal del wizard, dise√±ado
        para guiar al usuario a trav√©s del proceso de configuraci√≥n y
        exportaci√≥n de facturas.
        
        El dise√±o sigue el patr√≥n "Progressive Disclosure": mostramos
        informaci√≥n b√°sica primero, y revelamos opciones avanzadas seg√∫n
        las necesidades del usuario.
    -->
    <record id="view_batch_export_wizard_form" model="ir.ui.view">
        <field name="name">batch.export.wizard.form</field>
        <field name="model">batch.export.wizard</field>
        <field name="arch" type="xml">
            <form string="Exportaci√≥n Masiva de Facturas">
                <!--
                    ESTADO DEL WIZARD: CONFIGURACI√ìN vs RESULTADO
                    =============================================
                    
                    El wizard tiene dos "estados" principales:
                    1. Configuraci√≥n: Antes de ejecutar la exportaci√≥n
                    2. Resultado: Despu√©s de completar la exportaci√≥n
                    
                    Usamos el campo 'export_file' como indicador de estado:
                    - Si export_file est√° vac√≠o = estado de configuraci√≥n
                    - Si export_file tiene valor = estado de resultado
                    
                    Esta t√©cnica permite que la misma vista XML sirva para
                    ambos prop√≥sitos, proporcionando una experiencia fluida
                    sin necesidad de m√∫ltiples vistas.
                -->
                
                <!-- =============================================== -->
                <!-- SECCI√ìN 1: CONFIGURACI√ìN (antes de exportar)   -->
                <!-- =============================================== -->
                <group name="configuration_section" invisible="export_file">
                    <!--
                        CONFIGURACI√ìN PRINCIPAL
                        =====================
                        
                        Esta secci√≥n contiene los controles principales que
                        todo usuario necesita configurar para realizar una
                        exportaci√≥n exitosa.
                    -->
                    <group string="üè¢ Configuraci√≥n Principal" colspan="4">
                        <group>
                            <!--
                                Campo de Empresa con Widget de Selecci√≥n
                                =======================================
                                
                                widget="selection": Muestra empresas como dropdown
                                en lugar de campo de b√∫squeda. Mejor UX cuando hay
                                pocas empresas (caso t√≠pico en instalaciones PyME).
                            -->
                            <field name="company_id" 
                                   widget="selection"
                                   options="{'no_create': True, 'no_open': True}"/>
                            
                            <!--
                                Plantilla con Domain Din√°mico
                                ============================
                                
                                domain="[('company_id', '=', company_id), ('active', '=', True)]"
                                
                                Este domain se eval√∫a din√°micamente en el navegador,
                                filtrando las plantillas seg√∫n la empresa seleccionada.
                                Es un ejemplo perfecto de c√≥mo Odoo hace la interfaz
                                reactiva sin necesidad de JavaScript personalizado.
                            -->
                            <field name="export_template_id"
                                   domain="[('company_id', '=', company_id), ('active', '=', True)]"
                                   context="{'default_company_id': company_id}"
                                   options="{'no_create_edit': True}"/>
                        </group>
                        
                        <group>
                            <!--
                                Formato de Compresi√≥n con Widget Radio
                                =====================================
                                
                                widget="radio": Muestra todas las opciones visibles
                                simult√°neamente. Mejor para 2-5 opciones donde el
                                usuario necesita ver todas las alternativas.
                                
                                El m√©todo _get_available_compression_formats() en
                                el modelo Python controla qu√© opciones aparecen.
                            -->
                            <field name="compression_format" 
                                   widget="radio"
                                   class="o_horizontal"/>
                            
                            <!--
                                Tama√±o de Lote con Validaci√≥n Visual
                                ===================================
                                
                                Este campo incluye ayuda contextual que explica
                                el impacto de diferentes valores en el rendimiento.
                            -->
                            <field name="batch_size"/>
                        </group>
                    </group>
                    
                    <!--
                        FILTROS DE DOCUMENTOS
                        ====================
                        
                        Esta secci√≥n permite al usuario especificar exactamente
                        qu√© tipos de documentos quiere incluir en la exportaci√≥n.
                    -->
                    <group string="üìÑ Tipos de Documentos" colspan="4">
                        <group>
                            <!--
                                Checkboxes Booleanos para Filtros
                                ================================
                                
                                Los campos booleanos se renderizan autom√°ticamente
                                como checkboxes, proporcionando una interfaz
                                intuitiva para opciones de s√≠/no.
                            -->
                            <field name="include_customer_invoices"/>
                            <field name="include_vendor_bills"/>
                            <field name="include_credit_notes"/>
                        </group>
                        
                        <group>
                            <!--
                                Campo Computed para Vista Previa
                                ===============================
                                
                                Este campo muestra din√°micamente cu√°ntas facturas
                                se exportar√°n con los filtros actuales, proporcionando
                                feedback inmediato al usuario.
                            -->
                            <field name="estimated_invoice_count" 
                                   readonly="1"
                                   class="oe_inline"
                                   string="Facturas estimadas"/>
                        </group>
                    </group>
                    
                    <!--
                        FILTROS DE FECHA Y ESTADO
                        ========================
                        
                        Controles para refinar temporalmente qu√© facturas incluir.
                    -->
                    <group string="üìÖ Filtros de Fecha y Estado" colspan="4">
                        <group>
                            <!--
                                Campos de Fecha con Widget Calendar
                                ==================================
                                
                                widget="date": Proporciona selector de calendario
                                visual. Mejor UX que campos de texto plano.
                            -->
                            <field name="date_from" widget="date"/>
                            <field name="date_to" widget="date"/>
                        </group>
                        
                        <group>
                            <!--
                                Estado con Widget Radio Horizontal
                                =================================
                                
                                class="o_horizontal": Disposici√≥n horizontal
                                para opciones radio, ahorrando espacio vertical.
                            -->
                            <field name="state_filter" 
                                   widget="radio"
                                   class="o_horizontal"/>
                        </group>
                    </group>
                    
                    <!--
                        FACTURAS PRESELECCIONADAS (CONDICIONAL)
                        ======================================
                        
                        Esta secci√≥n solo aparece cuando el usuario ha seleccionado
                        facturas espec√≠ficas antes de abrir el wizard.
                        
                        invisible="not invoice_ids": Se oculta cuando la lista
                        de facturas preseleccionadas est√° vac√≠a.
                    -->
                    <group string="üìã Facturas Preseleccionadas" 
                           colspan="4" 
                           invisible="not invoice_ids">
                        
                        <!--
                            Tree View Embebida para Facturas
                            ===============================
                            
                            Esta es una vista de lista embebida dentro del formulario
                            del wizard. Permite al usuario ver y refinar la selecci√≥n
                            de facturas sin salir del contexto actual.
                        -->
                        <field name="invoice_ids" nolabel="1" colspan="4">
                            <tree string="Facturas Seleccionadas" 
                                  create="false" 
                                  edit="false"
                                  delete="true">
                                <!--
                                    create="false": No permite crear facturas desde aqu√≠
                                    edit="false": No permite editar facturas en l√≠nea
                                    delete="true": Permite quitar facturas de la selecci√≥n
                                    
                                    Esta configuraci√≥n tiene sentido: el usuario puede
                                    refinar su selecci√≥n quitando facturas, pero no
                                    deber√≠a crear o editar facturas desde el wizard.
                                -->
                                
                                <field name="name" string="N√∫mero"/>
                                <field name="partner_id" string="Cliente/Proveedor"/>
                                <field name="invoice_date" string="Fecha"/>
                                <field name="amount_total" string="Total" 
                                       widget="monetary"/>
                                <field name="state" string="Estado"/>
                                
                                <!--
                                    Campo de Empresa Solo en Multi-Empresa
                                    ====================================
                                    
                                    groups="base.group_multi_company": Solo muestra
                                    este campo si el usuario pertenece al grupo de
                                    usuarios multi-empresa. Reduce saturaci√≥n visual
                                    en instalaciones de empresa √∫nica.
                                -->
                                <field name="company_id" 
                                       string="Empresa"
                                       groups="base.group_multi_company"/>
                            </tree>
                        </field>
                        
                        <!--
                            Nota Informativa con Estilos Bootstrap
                            ====================================
                            
                            Odoo incluye Bootstrap CSS, permitiendo usar clases
                            como 'alert' para crear mensajes informativos visualmente
                            consistentes con el resto del sistema.
                        -->
                        <div class="alert alert-info" role="alert" colspan="4">
                            <strong>üí° Consejo:</strong> Puede quitar facturas espec√≠ficas 
                            de la selecci√≥n usando el bot√≥n ‚ùå en cada fila. Las facturas 
                            quitadas no se incluir√°n en la exportaci√≥n.
                        </div>
                    </group>
                    
                    <!--
                        NOTA INFORMATIVA GENERAL
                        =======================
                        
                        Proporciona orientaci√≥n al usuario sobre el comportamiento
                        del sistema cuando no hay facturas preseleccionadas.
                    -->
                    <group colspan="4" invisible="invoice_ids">
                        <div class="alert alert-info" role="alert">
                            <strong>‚ÑπÔ∏è Informaci√≥n:</strong> Como no hay facturas 
                            preseleccionadas, se exportar√°n todas las facturas que 
                            cumplan los filtros configurados arriba.
                            <br/><br/>
                            <strong>üìù Formato de nombres:</strong> Los archivos se 
                            nombrar√°n seg√∫n la plantilla seleccionada o usando el formato: 
                            <code>[TIPO]_[N√öMERO]_[CLIENTE]_[FECHA].pdf</code>
                        </div>
                    </group>
                </group>
                
                <!-- =============================================== -->
                <!-- SECCI√ìN 2: RESULTADOS (despu√©s de exportar)    -->
                <!-- =============================================== -->
                <group name="results_section" invisible="not export_file">
                    <!--
                        M√âTRICAS DE EXPORTACI√ìN
                        ======================
                        
                        Muestra estad√≠sticas detalladas sobre la exportaci√≥n
                        completada, incluyendo rendimiento y calidad.
                    -->
                    <group string="üìä Resultados de Exportaci√≥n" colspan="4">
                        <group>
                            <!--
                                Contador de Facturas Exportadas
                                ===============================
                                
                                readonly="1": Campo de solo lectura en Odoo 17
                                (m√°s limpio que la sintaxis anterior con attrs)
                            -->
                            <field name="export_count" 
                                   readonly="1"
                                   class="o_stat_info"/>
                            
                            <!--
                                Contador de Errores (Condicional)
                                ================================
                                
                                invisible="not failed_count": Solo muestra este
                                campo si hubo facturas que fallaron, evitando
                                confusi√≥n cuando todo sale bien.
                            -->
                            <field name="failed_count" 
                                   readonly="1"
                                   class="o_stat_info"
                                   invisible="not failed_count"/>
                        </group>
                        
                        <group>
                            <!--
                                M√©tricas de Rendimiento
                                ======================
                                
                                widget="percentage": Formatea autom√°ticamente
                                el valor como porcentaje (0.75 ‚Üí 75%)
                            -->
                            <field name="compression_ratio" 
                                   readonly="1"
                                   widget="percentage"/>
                            
                            <field name="processing_time" 
                                   readonly="1"
                                   string="Tiempo (segundos)"/>
                        </group>
                        
                        <!--
                            DESCARGA DEL ARCHIVO
                            ===================
                            
                            Esta es la funcionalidad principal: permitir al usuario
                            descargar el archivo generado.
                        -->
                        <group colspan="4">
                            <!--
                                Campo Binario con Nombre de Archivo
                                ==================================
                                
                                filename="export_filename": Usa el valor del campo
                                export_filename como nombre sugerido para la descarga.
                                
                                El campo export_filename debe existir pero puede estar
                                oculto (invisible="1") ya que solo se usa internamente.
                            -->
                            <field name="export_filename" invisible="1"/>
                            <field name="export_file" 
                                   filename="export_filename"
                                   readonly="1"
                                   string="üì¶ Descargar Archivo de Exportaci√≥n"
                                   colspan="4"/>
                        </group>
                    </group>
                    
                    <!--
                        MENSAJE DE √âXITO CON INFORMACI√ìN DIN√ÅMICA
                        ========================================
                        
                        Muestra un mensaje de √©xito que incluye informaci√≥n
                        espec√≠fica sobre la exportaci√≥n realizada.
                    -->
                    <group colspan="4">
                        <div class="alert alert-success" role="alert">
                            <strong>‚úÖ ¬°Exportaci√≥n exitosa!</strong>
                            <br/><br/>
                            Se han exportado exitosamente 
                            <field name="export_count" readonly="1" class="oe_inline"/> 
                            facturas con una compresi√≥n de 
                            <field name="compression_ratio" readonly="1" class="oe_inline" widget="percentage"/>.
                            <br/><br/>
                            <!--
                                Mensaje Condicional para Errores Parciales
                                ==========================================
                                
                                invisible="not failed_count": Solo muestra informaci√≥n
                                sobre errores si realmente hubo algunos.
                            -->
                            <span invisible="not failed_count">
                                <strong>‚ö†Ô∏è Atenci√≥n:</strong> 
                                <field name="failed_count" readonly="1" class="oe_inline"/> 
                                facturas no pudieron ser exportadas debido a errores. 
                                Consulte los logs del sistema para m√°s detalles.
                                <br/><br/>
                            </span>
                            
                            <strong>üîΩ Haga clic en el enlace de arriba para descargar el archivo.</strong>
                        </div>
                    </group>
                </group>
                
                <!--
                    FOOTER CON BOTONES DE ACCI√ìN
                    ===========================
                    
                    El footer contiene los botones que controlan el flujo del wizard.
                    La visibilidad de cada bot√≥n depende del estado actual.
                -->
                <footer>
                    <!--
                        BOT√ìN DE EXPORTACI√ìN
                        ===================
                        
                        Este es el bot√≥n principal que inicia todo el proceso.
                        Solo es visible antes de realizar la exportaci√≥n.
                    -->
                    <button name="action_export_invoices"
                            string="üöÄ Iniciar Exportaci√≥n"
                            type="object"
                            class="btn-primary"
                            invisible="export_file"
                            help="Iniciar el proceso de exportaci√≥n masiva con la configuraci√≥n especificada"/>
                    
                    <!--
                        BOT√ìN CERRAR (despu√©s de exportar)
                        =================================
                        
                        Aparece despu√©s de completar la exportaci√≥n.
                        special="cancel": Cierra el wizard sin ejecutar c√≥digo adicional.
                    -->
                    <button string="‚úÖ Cerrar"
                            special="cancel"
                            class="btn-secondary"
                            invisible="not export_file"
                            help="Cerrar el wizard de exportaci√≥n"/>
                    
                    <!--
                        BOT√ìN CANCELAR (antes de exportar)
                        =================================
                        
                        Permite cancelar el proceso antes de iniciarlo.
                        Aparece en la misma posici√≥n que "Cerrar" pero con
                        texto diferente para reflejar el contexto.
                    -->
                    <button string="‚ùå Cancelar"
                            special="cancel"
                            class="btn-secondary"
                            invisible="export_file"
                            help="Cancelar y cerrar sin realizar exportaci√≥n"/>
                </footer>
            </form>
        </field>
    </record>
    
    <!--
        ACCI√ìN PRINCIPAL DEL WIZARD
        ==========================
        
        Define c√≥mo se abre y comporta el wizard cuando es invocado.
        Esta acci√≥n conecta el modelo Python con la vista XML.
    -->
    <record id="action_batch_export_wizard" model="ir.actions.act_window">
        <field name="name">Exportaci√≥n Masiva de Facturas</field>
        <field name="res_model">batch.export.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <!--
            target="new": Abre en ventana modal (overlay)
            
            Alternativas:
            - target="current": Reemplaza la vista actual
            - target="fullscreen": Pantalla completa
            - target="main": Ventana principal (raro)
            
            Para wizards, "new" (modal) es casi siempre la opci√≥n correcta
            porque mantiene el contexto de d√≥nde vino el usuario.
        -->
        
        <!--
            BINDING DE LA ACCI√ìN
            ===================
            
            Estos campos hacen que la acci√≥n aparezca autom√°ticamente
            en el men√∫ "Acci√≥n" cuando el usuario selecciona facturas.
        -->
        <field name="binding_model_id" ref="account.model_account_move"/>
        <field name="binding_view_types">list</field>
        <!--
            binding_view_types="list": Solo aparece en vista de lista
            
            Otras opciones:
            - "form": Solo en vista de formulario
            - "list,form": En ambas vistas
            - Sin especificar: En todas las vistas
            
            Para exportaci√≥n masiva, "list" tiene sentido porque
            necesitas seleccionar m√∫ltiples registros.
        -->
        
        <!--
            CONFIGURACI√ìN ADICIONAL DE LA ACCI√ìN
            ===================================
        -->
        <field name="help">
            <![CDATA[
                <p class="o_view_nocontent_smiling_face">
                    Exportaci√≥n Masiva de Facturas
                </p>
                <p>
                    Seleccione facturas de la lista y use el bot√≥n "Acci√≥n" 
                    para acceder a la exportaci√≥n masiva, o abra este wizard 
                    directamente para configurar filtros personalizados.
                </p>
            ]]>
        </field>
    </record>
    
    <!--
        √çTEM DE MEN√ö PRINCIPAL
        =====================
        
        A√±ade un enlace directo al wizard en el men√∫ de contabilidad.
        Esto permite acceder al wizard sin necesidad de seleccionar facturas.
    -->
    <menuitem id="menu_batch_export_wizard"
              name="Exportaci√≥n Masiva"
              parent="account.menu_finance_reports"
              action="action_batch_export_wizard"
              sequence="85"
              groups="account.group_account_user"/>
    <!--
        sequence="85": Controla la posici√≥n en el men√∫
        - N√∫meros bajos aparecen primero
        - N√∫meros altos aparecen al final
        - 85 coloca el √≠tem hacia el final pero antes de √≠tems de configuraci√≥n
        
        groups="account.group_account_user": Solo visible para usuarios
        con permisos de contabilidad. Esto tiene sentido porque las facturas
        son datos contables sensibles.
    -->

</odoo>

<!--
    CONCEPTOS AVANZADOS DE VISTAS EN ODOO
    ====================================
    
    Progressive Disclosure (Revelaci√≥n Progresiva)
    ---------------------------------------------
    Este wizard implementa el principio de Progressive Disclosure:
    - Muestra informaci√≥n esencial primero
    - Revela detalles seg√∫n las necesidades del usuario
    - Oculta complejidad innecesaria hasta que sea relevante
    
    Esto mejora la usabilidad porque:
    - Reduce la carga cognitiva inicial
    - Permite workflows tanto simples como avanzados
    - Evita saturaci√≥n visual de la interfaz
    
    Reactive UI sin JavaScript Personalizado
    ---------------------------------------
    Odoo proporciona reactividad autom√°tica a trav√©s de:
    - Domains din√°micos: Filtros que cambian seg√∫n otros campos
    - Campos computed: Informaci√≥n que se actualiza autom√°ticamente
    - Visibilidad condicional: Elementos que aparecen/desaparecen
    - Validaci√≥n en tiempo real: Feedback inmediato sobre errores
    
    Esto elimina la necesidad de escribir JavaScript personalizado
    para la mayor√≠a de casos de uso comunes.
    
    Consistencia Visual con el Core de Odoo
    --------------------------------------
    Al usar las clases CSS y patrones de Odoo (alert, btn-primary, etc.)
    garantizamos que nuestra interfaz:
    - Se vea nativa, no como un plugin externo
    - Funcione correctamente en todos los dispositivos
    - Sea accesible para usuarios con discapacidades
    - Se beneficie autom√°ticamente de mejoras futuras en el core
    
    Separaci√≥n de Responsabilidades
    ------------------------------
    La clara separaci√≥n entre:
    - Modelo (batch_export_wizard.py): L√≥gica de negocio
    - Vista (este archivo): Presentaci√≥n e interacci√≥n
    - Acci√≥n (records en este archivo): Navegaci√≥n y contexto
    
    Facilita el mantenimiento y permite que diferentes desarrolladores
    trabajen en diferentes aspectos sin conflictos.
    
    Internacionalizaci√≥n Autom√°tica
    ------------------------------
    Al usar la funci√≥n _() en strings y mantener textos en espa√±ol
    en las vistas, facilitamos la traducci√≥n autom√°tica. Odoo puede
    extraer todos estos strings y generar archivos de traducci√≥n
    autom√°ticamente.
    
    Accesibilidad Web
    ----------------
    El uso de elementos como:
    - role="alert" para mensajes importantes
    - Etiquetas descriptivas en todos los campos
    - Estructura sem√°ntica apropiada (groups, headers)
    - Texto alternativo para iconos emoji
    
    Garantiza que la interfaz sea accesible para usuarios que usan
    lectores de pantalla u otras tecnolog√≠as de asistencia.
-->
